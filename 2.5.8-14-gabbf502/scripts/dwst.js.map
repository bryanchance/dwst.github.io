{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./dwst/scripts/types/util/parsee.js","webpack:///./dwst/scripts/types/abstract/error.js","webpack:///./dwst/scripts/types/errors/errors.js","webpack:///./dwst/scripts/lib/utils.js","webpack:///./dwst/scripts/lib/parser.js","webpack:///./dwst/scripts/lib/control.js","webpack:///./dwst/scripts/lib/lib.js","webpack:///./dwst/scripts/types/abstract/function.js","webpack:///./dwst/scripts/types/m/m.js","webpack:///./dwst/scripts/types/types.js","webpack:///./dwst/scripts/types/abstract/abstract.js","webpack:///./dwst/scripts/types/util/util.js","webpack:///./dwst/scripts/model/config.js","webpack:///./dwst/scripts/model/history.js","webpack:///./dwst/scripts/model/variables.js","webpack:///./dwst/scripts/model/help/_chrome.js","webpack:///./dwst/scripts/model/help/_local.js","webpack:///./dwst/scripts/model/help/_firefox.js","webpack:///./dwst/scripts/model/help/_privacy.js","webpack:///./dwst/scripts/model/help/help.js","webpack:///./dwst/scripts/model/help/_main.js","webpack:///./dwst/scripts/model/help/_development.js","webpack:///./dwst/scripts/model/help/_styleguide.js","webpack:///./dwst/scripts/model/help/_simulator.js","webpack:///./dwst/scripts/model/help/_unprotected.js","webpack:///./dwst/scripts/model/help/_introduction.js","webpack:///./dwst/scripts/model/help/_commands.js","webpack:///./dwst/scripts/model/help/_functions.js","webpack:///./dwst/scripts/model/model.js","webpack:///./dwst/scripts/ui/renderers/time.js","webpack:///./dwst/scripts/ui/renderers/mlog.js","webpack:///./dwst/scripts/ui/renderers/log_entry.js","webpack:///./dwst/scripts/ui/renderers/direction.js","webpack:///./dwst/scripts/ui/components/terminal.js","webpack:///./dwst/scripts/ui/renderers/gfx.js","webpack:///./dwst/scripts/ui/components/clock.js","webpack:///./dwst/scripts/ui/components/prompt.js","webpack:///./dwst/scripts/ui/components/send_button.js","webpack:///./dwst/scripts/ui/components/menu_button.js","webpack:///./dwst/scripts/ui/components/screen.js","webpack:///./dwst/scripts/ui/components/auto_scroll_button.js","webpack:///./dwst/scripts/ui/components/scroll_notification.js","webpack:///./dwst/scripts/ui/components/file_input.js","webpack:///./dwst/scripts/ui/ui.js","webpack:///./dwst/scripts/controller/link.js","webpack:///./dwst/scripts/controller/template.js","webpack:///./dwst/scripts/controller/prompt.js","webpack:///./dwst/scripts/controller/socket.js","webpack:///./dwst/scripts/controller/error.js","webpack:///./dwst/scripts/controller/pwa.js","webpack:///./dwst/scripts/functions/byte_range.js","webpack:///./dwst/scripts/functions/char_range.js","webpack:///./dwst/scripts/functions/file.js","webpack:///./dwst/scripts/functions/random_bytes.js","webpack:///./dwst/scripts/functions/random_chars.js","webpack:///./dwst/scripts/functions/time.js","webpack:///./dwst/scripts/connection.js","webpack:///./dwst/scripts/dwst.js","webpack:///./dwst/scripts/controller/controller.js","webpack:///./dwst/scripts/model/plugins.js","webpack:///./dwst/scripts/plugins/binary.js","webpack:///./dwst/scripts/plugins/clear.js","webpack:///./dwst/scripts/plugins/connect.js","webpack:///./dwst/scripts/plugins/disconnect.js","webpack:///./dwst/scripts/plugins/forget.js","webpack:///./dwst/scripts/plugins/help.js","webpack:///./dwst/scripts/plugins/interval.js","webpack:///./dwst/scripts/plugins/pwa.js","webpack:///./dwst/scripts/plugins/reset.js","webpack:///./dwst/scripts/plugins/send.js","webpack:///./dwst/scripts/plugins/set.js","webpack:///./dwst/scripts/plugins/spam.js","webpack:///./dwst/scripts/plugins/splash.js","webpack:///./dwst/scripts/plugins/unset.js","webpack:///./dwst/scripts/plugins/vars.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","Parsee","constructor","original","this","_remainder","length","startsWith","str","read","slice","readUntil","stopChars","nextSpecialPos","inputString","chars","indices","Set","map","character","indexOf","delete","size","Math","min","indexOfAny","sliceIndex","readWhile","allowChars","limit","Infinity","mismatch","thisIndexOf","split","includes","indexOfNone","toString","DwstError","Error","super","errors","NoConnection","msg","AlreadyConnected","SocketError","InvalidTemplateExpression","expected","remainder","expression","errorPosition","InvalidArgument","argument","extraInfo","InvalidCombination","command","commands","InvalidUtf8","buffer","InvalidDataType","variable","InvalidVariableName","UnknownCommand","UnknownInstruction","instruction","UnknownHelpPage","page","UnknownVariable","utils","parseNum","substr","parseInt","chunkify","chunks","chunk","b","push","range","a","start","stop","Array","fill","_","htmlescape","text","replace","joinBuffers","buffersToJoin","total","out","Uint8Array","offset","set","specialChars","charCodeRange","end","startCode","charCodeAt","endCode","charCode","String","fromCharCode","digitChars","hexChars","concat","smallChars","bigChars","alphaChars","integerLiteralChars","variableNameChars","quote","string","skipSpace","parsee","readTemplateExpressionEscape","mapping","hex","type","readTemplateExpressionByte","readTemplateExpressionCodePoint","from","to","pair","readInteger","hexDigits","digits","readExpression","functionName","readVariableName","skipArgListOpen","args","functionArgs","some","chr","arg","readFunctionArgs","skipArgListClose","readParticle","expressionOpen","skipExpressionOpen","expressionClose","skipExpressionClose","readTemplateExpressionText","parser","parseTemplateExpression","templateExpression","particles","particle","readTemplateExpression","e","escapeForTemplateExpression","textString","replacer","rm","head","find","rep","parts","complete","part","news","join","isValidVariableName","variableName","controlCharNames","\u0000","\u0001","\u0002","\u0003","\u0004","\u0005","\u0006","\u0007","\b","\t","\n","\u000b","\f","\r","\u000e","\u000f","\u0010","\u0011","\u0012","\u0013","\u0014","\u0015","\u0016","\u0017","\u0018","\u0019","\u001a","\u001b","\u001c","\u001d","\u001e","\u001f","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""," ","­","controlChars","keys","readOne","nice","abbr","entries","parseControlChars","lib","control","DwstFunction","roundrobin","iterators","results","next","every","done","paragraph","lines","x","xs","delimiter","flatMap","item","arrayJoin","flat","help","section","userOptions","_objectSpread","warning","spacing","wrap","afterText","m_m","h1","h2","unsafe","regular","strong","link","url","syntax","code","title","hexline","hexes","line","vars","iterator","roundrobinMerge","sectionList","sections","sort","sec","arr","types","abstract","util","config","appVersion","VERSION","echoServer","ElementHistory","history","isArray","idx","getAll","getNext","getPrevious","gotoBottom","getLast","addItem","edition","callback","unshift","removeBottom","shift","getCurrent","getConnectCommands","cap","uniqueCommands","commandsSet","has","add","History","savedHistory","options","save","getHistoryLength","getSummary","historyLine","forget","emptyHistory","select","atBottom","Variables","dwst","functionClasses","_dwst","_functions","Map","_variables","Constructor","func","setVariable","getVariable","getFunction","deleteVariable","getVariableNames","getFunctionNames","disclaimer","commandSegments","gaSection","disableTracking","storageSection","futureChanges","help_UnknownCommand","help_UnknownHelpPage","topicMap","#firefox","#chrome","#local","#styleguide","#simulator","crumbSections","endsWith","createBreadCrumbs","crumbText","Help","_helpPage","longNames","filter","commandsPage","plugins","getNames","functions","funcName","functionsPage","model","variables","_commandHelp","plugin","getPlugin","usage","examples","info","_functionHelp","_pageContent","content","Model","connection","intervalId","renderTime","contentOnly","addzero","date","Date","getHours","getMinutes","getSeconds","time","document","createElement","setAttribute","innerHTML","hexify","num","hexdump","dv","DataView","byteLength","oneByte","getUint8","asChar","asHex","renderMlog","linkHandlers","domSections","ArrayBuffer","lineData","hexLines","getLineSegments","segment","rawSegment","rawText","safeText","textSpan","linkWrapper","linkWrapperClasses","classes","onclick","evt","preventDefault","onHelpLinkClick","appendChild","afterTextNode","createTextNode","onCommandLinkClick","hexChunks","textChunks","byteGrid","byteGridClasses","chunkLength","forEach","hexChunk","textChunk","hexContent","hexItem","textContent","padEnd","textItem","renderSegment","outputCell","classList","textData","truncated","domSection","domLine","domSegment","br","renderLogEntry","mlog","direction","renderDirection","logEntry","timeCell","directionCell","contentCell","hilightControlChars","mlogItems","CR","LF","previous","createLines","partToMlog","Terminal","element","_element","_limit","reset","_addLogItem","logLine","userWasScrolling","ui","screen","isUserScrolling","childElementCount","removeChild","firstChild","scrollLog","clearLog","logClear","gfx","colors","gfxContent","li","ci","color","background","safe","safeco","gfxContainer","renderGfx","updateGfxPositions","mlogDescription","assign","controller","log","blog","view","tlog","Clock","refreshClock","startClock","remove","setInterval","onLoad","Prompt","_enableDebugger","documentElement","send","raw","terminal","prompt","loud","_keyHandler","event","keyCode","offerConnect","connects","focus","init","addEventListener","SendButton","MenuButton","connected","state","Screen","scrollHeight","offsetHeight","scrollTop","scrollNotification","hideScrollNotification","AutoScrollButton","ScrollNotification","scrollNotificationUpdate","showScrollNotification","removeAttribute","FileInput","upload","getElementsByTagName","onchange","file","files","click","Ui","_resizePending","getElementById","clock","sendButton","menuButton","autoScrollButton","fileInput","globalKeyPress","isOpen","isConnecting","Reflect","apply","getElementsByClassName","maxDiv","ref","refWidth","offsetWidth","windowWidth","window","innerWidth","maxFit","floor","leftMargin","invisible","round","_throttledUpdateGfxPositions","setTimeout","silent","LinkHandler","TemplateHandler","_encoder","TextEncoder","_evalFunction","run","[object Object]","encode","fromCodePoint","output","rootNode","Promise","all","_evalParticle","eval","_evalTemplateExpression","PromptHandler","pluginName","paramString","params","_runPlugin","catch","error","noslash","substring","SocketHandler","onConnectionOpen","protocol","selected","onConnectionClose","sessionLength","meanings","1000","1001","1002","1003","1005","1006","1007","1008","1009","1010","1011","1015","reason","sessionLengthString","onMessage","fr","FileReader","target","result","readAsArrayBuffer","onError","beforeSendWhileConnecting","verb","onSend","error_NoConnection","error_AlreadyConnected","error_SocketError","error_InvalidTemplateExpression","error_InvalidArgument","error_InvalidCombination","error_InvalidUtf8","error_InvalidDataType","error_InvalidVariableName","error_UnknownCommand","error_UnknownInstruction","error_UnknownHelpPage","commaCommaOr","stringList","last","ErrorHandler","_errorToMLog","padding","repeat","got","charAt","onDwstError","PwaHandler","_prompt","beforeInstallPrompt","onInstall","ByteRange","bytes","CharRange","File","_readFile","resolve","reader","fileContents","RandomBytes","random","RandomChars","randomchar","Time","getTime","FakeSocket","readyState","_path","pop","_nextFlood","onopen","_flood","count","onmessage","data","message","Blob","close","clearTimeout","onclose","Connection","protocols","_controller","sessionStartTime","ws","SocketConstructor","WebSocket","_onopen","_onclose","_onmessage","onerror","_onerror","isClosing","isClosed","seal","response","localStorage","getItem","JSON","parse","saveState","stringify","setItem","loadModel","template","socket","pwa","pluginClasses","_commands","_run","protocolString","protocolName","basicAlphabet","httpSeparators","validProtocolChars","usedChars","invalidChars","invalidCharsString","self","origin","secureConnect","protoFormatted","negotiation","_removeHistory","intervalStr","commandParts","clearInterval","payload","firstPart","otherParts","interval","TextDecoder","fatal","_encode","decode","TypeError","templateExpressionParts","timesStr","times","spam","xmasColors","now","getDate","month","getMonth","historySummary","maybeTooManyConnectCommands","CONNECTION_LIST_CAP","connectCommands","connectionsLines","tooManyWarning","historySection","statusSection","connectionStatus","maybeProtocolStatus","disconnectInstructions","about","beginnerInfo","helpReminder","privacyReminder","linkSection","v","listing","strs","navigator","serviceWorker","register"],"mappings":"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","file":"dwst.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","/**\n\n  Authors: Toni Ruottu, Finland 2017-2018\n           Lauri Kaitala, Finland 2017\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nfunction indexOfAny(inputString, chars) {\n  const indices = new Set(chars.map(character => {\n    return inputString.indexOf(character);\n  }));\n  indices.delete(-1);\n  if (indices.size === 0) {\n    return -1;\n  }\n  return Math.min(...indices);\n}\n\nfunction indexOfNone(inputString, chars) {\n  const indices = inputString.split('').map(character => {\n    return chars.includes(character);\n  });\n  const thisIndexOf = indices.indexOf(false);\n  if (thisIndexOf === -1) {\n    return inputString.length;\n  }\n  return thisIndexOf;\n}\n\nexport default class Parsee {\n\n  constructor(original) {\n    this._remainder = original;\n  }\n\n  get length() {\n    return this._remainder.length;\n  }\n\n  startsWith(str) {\n    return this._remainder.startsWith(str);\n  }\n\n  read(str) {\n    if (this._remainder.startsWith(str) === false) {\n      return false;\n    }\n    this._remainder = this._remainder.slice(str.length);\n    return true;\n  }\n\n  readUntil(stopChars) {\n    const nextSpecialPos = indexOfAny(this._remainder, stopChars);\n    let sliceIndex;\n    if (nextSpecialPos === -1) {\n      sliceIndex = this._remainder.length;\n    } else {\n      sliceIndex = nextSpecialPos;\n    }\n    const chars = this._remainder.slice(0, sliceIndex);\n    this._remainder = this._remainder.slice(sliceIndex);\n    return chars;\n  }\n\n  readWhile(allowChars, limit = Infinity) {\n    const mismatch = indexOfNone(this._remainder, allowChars);\n    const sliceIndex = Math.min(mismatch, limit);\n    const chars = this._remainder.slice(0, sliceIndex);\n    this._remainder = this._remainder.slice(sliceIndex);\n    return chars;\n  }\n\n  toString() {\n    return this._remainder;\n  }\n}\n\n","/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nexport default class DwstError extends Error {\n  constructor() {\n    super();\n    if (new.target === DwstError) {\n      throw new Error('abstract');\n    }\n  }\n}\n","/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport DwstError from '../abstract/error.js';\n\nclass NoConnection extends DwstError {\n  constructor(msg) {\n    super();\n    this.msg = msg;\n  }\n}\n\nclass AlreadyConnected extends DwstError {}\n\nclass SocketError extends DwstError {}\n\nclass InvalidTemplateExpression extends DwstError {\n  constructor(expected, remainder, expression = null) {\n    super();\n    this.expected = expected;\n    this.remainder = remainder;\n    this.expression = expression;\n  }\n  get errorPosition() {\n    return this.expression.length - this.remainder.length;\n  }\n}\n\nclass InvalidArgument extends DwstError {\n  constructor(argument, extraInfo) {\n    super();\n    this.argument = argument;\n    this.extraInfo = extraInfo;\n  }\n}\n\nclass InvalidCombination extends DwstError {\n  constructor(command, commands) {\n    super();\n    this.command = command;\n    this.commands = commands;\n  }\n}\n\nclass InvalidUtf8 extends DwstError {\n  constructor(buffer) {\n    super();\n    this.buffer = buffer;\n  }\n}\n\nclass InvalidDataType extends DwstError {\n  constructor(variable, expected) {\n    super();\n    this.variable = variable;\n    this.expected = expected;\n  }\n}\n\nclass InvalidVariableName extends DwstError {\n  constructor(variable) {\n    super();\n    this.variable = variable;\n  }\n}\n\nclass UnknownCommand extends DwstError {\n  constructor(command) {\n    super();\n    this.command = command;\n  }\n}\n\nclass UnknownInstruction extends DwstError {\n  constructor(instruction) {\n    super();\n    this.instruction = instruction;\n  }\n}\n\nclass UnknownHelpPage extends DwstError {\n  constructor(page) {\n    super();\n    this.page = page;\n  }\n}\n\nclass UnknownVariable extends DwstError {\n  constructor(variable) {\n    super();\n    this.variable = variable;\n  }\n}\n\nexport default {\n  NoConnection,\n  AlreadyConnected,\n  SocketError,\n  InvalidTemplateExpression,\n  InvalidArgument,\n  InvalidCombination,\n  InvalidUtf8,\n  InvalidDataType,\n  InvalidVariableName,\n  UnknownCommand,\n  UnknownInstruction,\n  UnknownHelpPage,\n  UnknownVariable,\n};\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nexport default {\n\n  parseNum: str => {\n    if (str.length > 2 && str.substr(0, 2) === '0x') {\n      return parseInt(str.substr(2), 16);\n    }\n    const num = parseInt(str, 10);\n    return num;\n  },\n\n  chunkify: (l, n) => {\n    const chunks = [];\n    let chunk = [];\n    let i = 0;\n    for (const b of l) {\n      if (i >= n) {\n        chunks.push(chunk);\n        chunk = [];\n        i = 0;\n      }\n      chunk.push(b);\n      i += 1;\n    }\n    chunks.push(chunk);\n    return chunks;\n  },\n\n  range: (a, b = null) => {\n    let start;\n    let stop;\n    if (b === null) {\n      start = 0;\n      stop = a;\n    } else {\n      start = a;\n      stop = b;\n    }\n    const length = stop - start;\n    return Array(length).fill().map((_, i) => start + i);\n  },\n\n  htmlescape: text => {\n    return text.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');\n  },\n\n  joinBuffers: buffersToJoin => {\n    let total = 0;\n    for (const buffer of buffersToJoin) {\n      total += buffer.length;\n    }\n    const out = new Uint8Array(total);\n    let offset = 0;\n    for (const buffer of buffersToJoin) {\n      out.set(buffer, offset);\n      offset += buffer.length;\n    }\n    return out;\n  },\n\n};\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2017-2018\n           Lauri Kaitala, Finland 2017-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\n// DWST template expression parser\n\nimport Parsee from '../types/util/parsee.js';\nimport errors from '../types/errors/errors.js';\nconst {InvalidTemplateExpression} = errors;\nimport utils from './utils.js';\n\nconst specialChars = [\n  '$',\n  '\\\\',\n];\n\nfunction charCodeRange(start, end) {\n  const startCode = start.charCodeAt(0);\n  const endCode = end.charCodeAt(0);\n  const charCodes = utils.range(startCode, endCode + 1);\n  return charCodes.map(charCode => String.fromCharCode(charCode));\n}\n\nconst digitChars = charCodeRange('0', '9');\nconst hexChars = charCodeRange('a', 'f').concat(digitChars);\nconst smallChars = charCodeRange('a', 'z');\nconst bigChars = charCodeRange('A', 'Z');\nconst alphaChars = smallChars.concat(bigChars);\n\nconst integerLiteralChars = hexChars.concat(['x']);\nconst variableNameChars = alphaChars;\n\nfunction quote(string) {\n  return `\"${string}\"`;\n}\n\nfunction isValidVariableName(variableName) {\n  const validated = new Parsee(variableName).readWhile(variableNameChars);\n  return (variableName === validated);\n}\n\nfunction skipSpace(parsee) {\n  while (parsee.read(' ')) {\n    // empty while on purpose\n  }\n}\n\nfunction readTemplateExpressionByte(parsee) {\n  const hex = parsee.readWhile(hexChars, 2);\n  if (hex.length < 2) {\n    throw new InvalidTemplateExpression(['hex digit'], String(parsee));\n  }\n  const value = parseInt(hex, 16);\n  return {type: 'byte', value};\n}\n\nfunction readTemplateExpressionCodePoint(parsee) {\n  let hex;\n  if (parsee.read('{')) {\n    hex = parsee.readWhile(hexChars, 6);\n    if (hex.length < 1) {\n      throw new InvalidTemplateExpression(['hex digit'], String(parsee));\n    }\n    if (parsee.length === 0) {\n      throw new InvalidTemplateExpression(['hex digit', '\"}\"'], String(parsee));\n    }\n    if (parsee.read('}') === false) {\n      throw new InvalidTemplateExpression(['\"}\"'], String(parsee));\n    }\n  } else {\n    hex = parsee.readWhile(hexChars, 4);\n    if (hex.length < 1) {\n      throw new InvalidTemplateExpression(['hex digit', '\"{\"'], String(parsee));\n    }\n    if (hex.length < 4) {\n      throw new InvalidTemplateExpression(['hex digit'], String(parsee));\n    }\n  }\n  const value = parseInt(hex, 16);\n  return {type: 'codepoint', value};\n}\n\nfunction readTemplateExpressionEscape(parsee) {\n  const mapping = [\n    ['\\\\', '\\\\'],\n    ['$', '$'],\n    ['n', '\\x0a'],\n    ['r', '\\x0d'],\n    ['0', '\\x00'],\n    ['x', null],\n    ['u', null],\n  ];\n  if (parsee.read('x')) {\n    return readTemplateExpressionByte(parsee);\n  }\n  if (parsee.read('u')) {\n    return readTemplateExpressionCodePoint(parsee);\n  }\n  if (parsee.length > 0) {\n    for (const [from, to] of mapping) {\n      if (parsee.read(from)) {\n        return {type: 'text', value: to};\n      }\n    }\n  }\n  const expected = mapping.map(pair => pair[0]);\n  throw new InvalidTemplateExpression(expected.map(quote), String(parsee));\n}\n\nfunction readTemplateExpressionText(parsee) {\n  const value = parsee.readUntil(specialChars);\n  return {type: 'text', value};\n}\n\nfunction skipExpressionOpen(parsee) {\n  const expressionOpen = '{';\n  if (parsee.read(expressionOpen) === false) {\n    throw new InvalidTemplateExpression([expressionOpen].map(quote), String(parsee));\n  }\n}\n\nfunction skipExpressionClose(parsee) {\n  const expressionClose = '}';\n  if (parsee.read(expressionClose) === false) {\n    throw new InvalidTemplateExpression([expressionClose].map(quote), String(parsee));\n  }\n}\n\nfunction skipArgListOpen(parsee) {\n  const argListOpen = '(';\n  if (parsee.read(argListOpen) === false) {\n    throw new Error('unexpected return value');\n  }\n}\n\nfunction skipArgListClose(parsee) {\n  const argListClose = ')';\n  if (parsee.read(argListClose) === false) {\n    throw new Error('unexpected return value');\n  }\n}\n\nfunction readVariableName(parsee) {\n  const functionName = parsee.readWhile(variableNameChars);\n  if (functionName.length === 0) {\n    throw new InvalidTemplateExpression(['a function name', 'a variable name'], String(parsee));\n  }\n  if (parsee.length === 0) {\n    throw new InvalidTemplateExpression(['(', '}'].map(quote), String(parsee));\n  }\n  return functionName;\n}\n\nfunction readInteger(parsee) {\n  if (parsee.read('0x')) {\n    const hexDigits = parsee.readWhile(hexChars);\n    if (hexDigits.length === 0) {\n      throw new InvalidTemplateExpression(['hex digit'], String(parsee));\n    }\n    const value = parseInt(hexDigits, 16);\n    return {type: 'int', value};\n  }\n  const digits = parsee.readWhile(digitChars);\n  if (digits.length === 0) {\n    throw new InvalidTemplateExpression(['an integer'], String(parsee));\n  }\n  const value = parseInt(digits, 10);\n  return {type: 'int', value};\n}\n\nfunction readFunctionArgs(parsee) {\n  const functionArgs = [];\n  if (parsee.startsWith(')')) {\n    return functionArgs;\n  }\n  if (integerLiteralChars.some(chr => parsee.startsWith(chr)) === false) {\n    const expected = ['an integer'].concat([')'].map(quote));\n    throw new InvalidTemplateExpression(expected, String(parsee));\n  }\n\n  while (true) {  // eslint-disable-line\n    const arg = readInteger(parsee);\n    functionArgs.push(arg);\n    skipSpace(parsee);\n    if (parsee.startsWith(')')) {\n      return functionArgs;\n    }\n    if (parsee.read(',') === false) {\n      throw new InvalidTemplateExpression([',', ')'].map(quote), String(parsee));\n    }\n    skipSpace(parsee);\n  }\n}\n\nfunction readExpression(parsee) {\n  const name = readVariableName(parsee);\n  skipSpace(parsee);\n  if (parsee.startsWith('(')) {\n    skipArgListOpen(parsee);\n    skipSpace(parsee);\n    const args = readFunctionArgs(parsee);\n    skipSpace(parsee);\n    skipArgListClose(parsee);\n    return {type: 'function', name, args};\n  }\n  if (parsee.startsWith('}')) {\n    return {type: 'variable', name};\n  }\n  throw new InvalidTemplateExpression(['(', '}'].map(quote), String(parsee));\n}\n\nfunction readParticle(parsee) {\n  if (parsee.read('\\\\')) {\n    return readTemplateExpressionEscape(parsee);\n  }\n  if (parsee.read('$')) {\n    skipExpressionOpen(parsee);\n    skipSpace(parsee);\n    const expression = readExpression(parsee);\n    skipSpace(parsee);\n    skipExpressionClose(parsee);\n    return expression;\n  }\n  return readTemplateExpressionText(parsee);\n}\n\nfunction readTemplateExpression(parsee) {\n  const particles = [];\n  while (parsee.length > 0) {\n    const particle = readParticle(parsee);\n    particles.push(particle);\n  }\n  return {type: 'templateExpression', particles};\n}\n\nfunction parseTemplateExpression(templateExpression) {\n  const parsee = new Parsee(templateExpression);\n  try {\n    return readTemplateExpression(parsee);\n  } catch (e) {\n    if (e instanceof InvalidTemplateExpression) {\n      e.expression = templateExpression;\n    }\n    throw e;\n  }\n}\n\nfunction escapeForTemplateExpression(textString) {\n  const replmap = [\n    ['$', '\\\\$'],\n    ['\\\\', '\\\\\\\\'],\n  ];\n\n  function replacer(str, rm) {\n    if (rm.length < 1) {\n      return str;\n    }\n    const head = rm[0];\n    const find = head[0];\n    const rep = head[1];\n\n    const parts = str.split(find);\n    const complete = [];\n    for (const part of parts) {\n      const loput = rm.slice(1);\n      const news = replacer(part, loput);\n      complete.push(news);\n    }\n    const out = complete.join(rep);\n    return out;\n  }\n  const complete = replacer(textString, replmap);\n  return complete;\n}\n\nexport default {\n  parseTemplateExpression,\n  escapeForTemplateExpression,\n  isValidVariableName,\n};\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport Parsee from '../types/util/parsee.js';\n\nconst controlCharNames = {\n\n  // C0 Controls\n\n  '\\x00': ['\\\\0', 'NUL', 'null terminator'],\n  '\\x01': [null, 'SOH', 'start of heading'],\n  '\\x02': [null, 'STX', 'start of text'],\n  '\\x03': [null, 'ETX', 'end of text'],\n  '\\x04': [null, 'EOT', 'end of transmission'],\n  '\\x05': [null, 'ENQ', 'enquiry'],\n  '\\x06': [null, 'ACK', 'acknowledge'],\n  '\\x07': [null, 'BEL', 'bell'],\n  '\\x08': [null, 'BS', 'backspace'],\n  '\\x09': [null, 'HT', 'horizontal tabulation'],\n  '\\x0a': ['\\\\n', 'LF', 'line feed'],\n  '\\x0b': [null, 'VT', 'vertical tabulation'],\n  '\\x0c': [null, 'FF', 'form feed'],\n  '\\x0d': ['\\\\r', 'CR', 'carriage return'],\n  '\\x0e': [null, 'SO', 'shift out'],\n  '\\x0f': [null, 'SI', 'shift in'],\n  '\\x10': [null, 'DLE', 'data link escape'],\n  '\\x11': [null, 'DC1', 'device control one'],\n  '\\x12': [null, 'DC2', 'device control two'],\n  '\\x13': [null, 'DC3', 'device control three'],\n  '\\x14': [null, 'DC4', 'device control four'],\n  '\\x15': [null, 'NAK', 'negative acknowledge'],\n  '\\x16': [null, 'SYN', 'synchronous idle'],\n  '\\x17': [null, 'ETB', 'end of transmission block'],\n  '\\x18': [null, 'CAN', 'cancel'],\n  '\\x19': [null, 'EM', 'end of medium'],\n  '\\x1a': [null, 'SUB', 'substitute'],\n  '\\x1b': [null, 'ESC', 'escape'],\n  '\\x1c': [null, 'FS', 'file separator'],\n  '\\x1d': [null, 'GS', 'group separator'],\n  '\\x1e': [null, 'RS', 'record separator'],\n  '\\x1f': [null, 'US', 'unit separator'],\n  '\\x7f': [null, 'DEL', 'delete'],\n\n  // C1 Controls\n\n  '\\x80': [null, 'XXX', '<control>'],\n  '\\x81': [null, 'XXX', '<control>'],\n  '\\x82': [null, 'BPH', 'break permitted here'],\n  '\\x83': [null, 'NBH', 'no break here'],\n  '\\x84': [null, 'IND', 'index'],\n  '\\x85': [null, 'NEL', 'next line'],\n  '\\x86': [null, 'SSA', 'start of selected area'],\n  '\\x87': [null, 'ESA', 'end of selected area'],\n  '\\x88': [null, 'HTS', 'character tabulation set'],\n  '\\x89': [null, 'HTJ', 'character tabulation with justification'],\n  '\\x8a': [null, 'VTS', 'line tabulation set'],\n  '\\x8b': [null, 'PLD', 'partial line forward'],\n  '\\x8c': [null, 'PLU', 'partial line backward'],\n  '\\x8d': [null, 'RI', 'reverse line feed'],\n  '\\x8e': [null, 'SS2', 'single shift two'],\n  '\\x8f': [null, 'SS3', 'single shift three'],\n  '\\x90': [null, 'DCS', 'device control string'],\n  '\\x91': [null, 'PU1', 'private use one'],\n  '\\x92': [null, 'PU2', 'private use two'],\n  '\\x93': [null, 'STS', 'set transmit state'],\n  '\\x94': [null, 'CCH', 'cancel character'],\n  '\\x95': [null, 'MW', 'message waiting'],\n  '\\x96': [null, 'SPA', 'start of guarded area'],\n  '\\x97': [null, 'EPA', 'end of guarded area'],\n  '\\x98': [null, 'SOS', 'start of string'],\n  '\\x99': [null, 'XXX', '<control>'],\n  '\\x9a': [null, 'SCI', 'single character introducer'],\n  '\\x9b': [null, 'CSI', 'control sequence introducer'],\n  '\\x9c': [null, 'ST', 'string terminator'],\n  '\\x9d': [null, 'OSC', 'operating system command'],\n  '\\x9e': [null, 'PM', 'privacy message'],\n  '\\x9f': [null, 'APC', 'application program command'],\n\n  // invisible Latin-1\n\n  '\\xa0': [null, 'NBSP', 'no-break space'],\n  '\\xad': [null, 'SHY', 'soft hyphen'],\n\n};\n\nconst controlChars = Object.keys(controlCharNames);\n\nfunction readOne(parsee) {\n  for (const [chr, [nice, abbr, name]] of Object.entries(controlCharNames)) {\n    if (parsee.read(chr)) {\n      return {\n        chr,\n        nice,\n        abbr,\n        name,\n      };\n    }\n  }\n  return parsee.readUntil(controlChars);\n}\n\nexport default function parseControlChars(msg) {\n  const parts = [];\n  const parsee = new Parsee(msg);\n  while (parsee.length > 0) {\n    const part = readOne(parsee);\n    parts.push(part);\n  }\n  return parts;\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport parser from './parser.js';\nimport control from './control.js';\nimport utils from './utils.js';\n\nexport default {\n  control,\n  utils,\n  parser,\n};\n","/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nexport default class DwstFunction {\n  constructor() {\n    if (new.target === DwstFunction) {\n      throw new Error('abstract');\n    }\n  }\n}\n","/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\n// DWST markup language\n\nfunction *roundrobin(...iterators) {\n  while (true) {\n    const results = iterators.map(i => i.next());\n    for (const r of results) {\n      if (typeof r.value !== 'undefined') {\n        yield r.value;\n      }\n    }\n    if (results.every(r => r.done)) {\n      return;\n    }\n  }\n}\n\nfunction roundrobinMerge(a, b) {\n  const ia = a[Symbol.iterator]();\n  const ib = b[Symbol.iterator]();\n  return [...roundrobin(ia, ib)];\n}\n\nfunction arrayJoin([x, ...xs], delimiter) {\n  return [x].concat(xs.flatMap(item => [delimiter, item]));\n}\n\nfunction paragraph(...lines) {\n  return arrayJoin(lines, ' ').flat();\n}\n\nfunction help(text, section = text, userOptions = {}) {\n  return {\n    warning: false,\n    spacing: false,\n    wrap: true,\n    afterText: null,\n    ...userOptions,\n    type: 'help',\n    text,\n    section,\n  };\n}\n\nfunction sectionList(sections) {\n  const spacing = true;\n  const wrap = false;\n  const available = sections.sort().map((sec, i, arr) => {\n    const lastIndex = arr.length - 1;\n    if (i < lastIndex) {\n      return help(sec, sec, {spacing, wrap, afterText: ','});\n    }\n    return help(sec, sec, {spacing, wrap});\n  });\n  return paragraph(...available);\n}\n\nexport default {\n  h1: text => ({type: 'h1', text}),\n  h2: text => ({type: 'h2', text}),\n  unsafe: text => ({type: 'regular', text, unsafe: true}),\n  regular: text => ({type: 'regular', text}),\n  strong: text => ({type: 'strong', text}),\n  command: text => ({type: 'command', text}),\n  link: (url, text = url) => ({type: 'link', text, url}),\n  syntax: text => ({type: 'syntax', text}),\n  code: text => ({type: 'code', text}),\n  control: (text, title) => ({type: 'control', text, title}),\n  hexline: (hexes, text) => ({type: 'hexline', text, hexes}),\n  line: (text, ...vars) => roundrobinMerge(text, vars),\n  help,\n  paragraph,\n  sectionList,\n};\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport abstract from './abstract/abstract.js';\nimport errors from './errors/errors.js';\nimport m from './m/m.js';\nimport util from './util/util.js';\n\nexport default {\n  abstract,\n  errors,\n  m,\n  util,\n};\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport DwstError from './error.js';\nimport DwstFunction from './function.js';\n\nexport default {\n  DwstError,\n  DwstFunction,\n};\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport Parsee from './parsee.js';\n\nexport default {\n  Parsee,\n};\n","\nconst appVersion = (() => {\n  if (typeof VERSION === 'undefined') {\n    return 'unknown-version';\n  }\n  return VERSION;\n})();\n\nexport default {\n  appVersion,\n  echoServer: 'wss://echo.websocket.org/',\n};\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n           William Orr, US 2012\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport m from '../types/m/m.js';\n\nclass ElementHistory {\n\n  constructor(history = []) {\n    if (!Array.isArray(history)) {\n      throw new Error('invalid history saveState');\n    }\n    this.idx = -1;\n    this.history = history;\n  }\n\n  get length() {\n    return this.history.length;\n  }\n\n  getAll() {\n    return this.history;\n  }\n\n  getNext() {\n    if (this.idx > 0) {\n      this.idx -= 1;\n      return this.history[this.idx];\n    }\n    if (this.idx === 0) {\n      this.idx -= 1;\n      return '';\n    }\n\n    return '';\n  }\n\n  getPrevious() {\n    if (this.history.length === 0) {\n      return '';\n    }\n    if (this.idx + 1 < this.history.length) {\n      this.idx += 1;\n      return this.history[this.idx];\n    }\n    return this.history[this.history.length - 1];\n  }\n\n  gotoBottom() {\n    this.idx = -1;\n  }\n\n  getLast() {\n    return this.history[0];\n  }\n\n  addItem(item, edition, callback) {\n    if (typeof item !== 'string') {\n      throw new Error('invalid type');\n    }\n    if (item !== '' && item !== this.getLast()) {\n      this.history.unshift(item);\n      if (edition) {\n        this.idx += 1;\n      }\n    }\n    callback();\n  }\n\n  removeBottom() {\n    this.history.shift();\n  }\n\n  getCurrent() {\n    return this.history[this.idx];\n  }\n\n  getConnectCommands(cap) {\n    const uniqueCommands = [];\n    const commandsSet = new Set();\n    for (const command of this.history) {\n      if (command.startsWith('/connect ') && !commandsSet.has(command)) {\n        uniqueCommands.push(command);\n        commandsSet.add(command);\n      }\n      if (uniqueCommands.length >= cap) {\n        return uniqueCommands;\n      }\n    }\n    return uniqueCommands;\n  }\n\n}\n\nexport default class History {\n\n  constructor(savedHistory, options) {\n    this.save = options.save;\n    this.history = new ElementHistory(savedHistory);\n  }\n\n  getHistoryLength() {\n    return this.history.length;\n  }\n\n  getSummary() {\n    const history = this.history.getAll();\n    const historyLine = ['History '];\n    if (history.length < 1) {\n      historyLine.push('is empty');\n    } else {\n      historyLine.push('contains ');\n      historyLine.push(m.strong(`${history.length}`));\n      if (history.length === 1) {\n        historyLine.push(' command');\n      } else {\n        historyLine.push(' commands');\n      }\n    }\n    return historyLine;\n  }\n\n  forget() {\n    const emptyHistory = [];\n    this.history = new ElementHistory(emptyHistory, {save: this.save});\n    this.save(emptyHistory);\n  }\n\n  addItem(value, edition) {\n    this.history.addItem(value, edition, () => {\n      const history = this.history.getAll();\n      this.save(history);\n    });\n  }\n\n  getNext(value) {\n    if (value !== this.history.getCurrent()) {\n      this.addItem(value, true);\n    }\n    return this.history.getNext();\n  }\n\n  getPrevious(value) {\n    if (value !== this.history.getCurrent()) {\n      this.addItem(value, true);\n    }\n    return this.history.getPrevious();\n  }\n\n  select(value) {\n    this.addItem(value);\n    this.history.gotoBottom();\n  }\n\n  atBottom() {\n    return this.history.idx === -1;\n  }\n\n  getConnectCommands(cap) {\n    return this.history.getConnectCommands(cap);\n  }\n}\n\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nexport default class Variables {\n\n  constructor(dwst, functionClasses) {\n    this._dwst = dwst;\n    this._functions = new Map();\n    this._variables = new Map();\n    for (const Constructor of functionClasses) {\n      const func = new Constructor(dwst);\n      for (const name of func.commands()) {\n        this._functions.set(name, func);\n      }\n    }\n  }\n\n  setVariable(variableName, value) {\n    if (this._dwst.lib.parser.isValidVariableName(variableName) === false) {\n      throw new this._dwst.types.errors.InvalidVariableName(variableName);\n    }\n    this._variables.set(variableName, value);\n  }\n\n  getVariable(variableName) {\n    const variable = this._variables.get(variableName);\n    if (typeof variable !== 'undefined') {\n      return variable;\n    }\n    return this.getFunction(variableName);\n  }\n\n  deleteVariable(variableName) {\n    this._variables.delete(variableName);\n  }\n\n  getVariableNames() {\n    return [...this._variables.keys()];\n  }\n\n  getFunction(functionName) {\n    // returns function even when it's variable had been deleted/overwritten\n    const func = this._functions.get(functionName);\n    if (typeof func !== 'undefined') {\n      return func;\n    }\n    return null;\n  }\n\n  getFunctionNames() {\n    return [...this._functions.keys()];\n  }\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport m from '../../types/m/m.js';\n\nconst disclaimer = [\n  m.h2('!!! Follow at your own risk !!!'),\n  '',\n  'Disabling security is generally a bad idea and you should only do it if you understand the implications.',\n];\n\nexport default function chromePage() {\n  return ([\n    m.h1('Insecure WebSocket Access in Chrome'),\n    '',\n    m.line`Chrome lets you temporarily bypass the security feature that prevents you from connecting to ${m.help('#unprotected')} WebSockets.`,\n    '',\n  ]).concat(disclaimer).concat([\n    '',\n    m.h2('Instructions'),\n    '',\n    m.line`1. Use ${m.help('connect')} on a ws:// address`,\n    '2. Look for a shield icon',\n    '3. Click on the shield icon',\n    '4. Click \"Load unsafe scripts\"',\n    '5. Use connect again',\n    '',\n  ]);\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport m from '../../types/m/m.js';\n\nconst commands = [\n  'git clone https://github.com/dwst/dwst.git',\n  'cd dwst',\n  'npm install -g yarn',\n  'yarn',\n  'gulp dev',\n];\n\nconst commandSegments = commands.map(m.code);\n\nexport default function localPage() {\n  return ([\n    m.h1('DWST Development Server'),\n    '',\n    'You can run DWST local development server by executing the following commands in the shell near you.',\n    '',\n  ]).concat(commandSegments).concat([\n    '',\n    m.line`This is useful if you wish to customise DWST on source code level but can also be used to access ${m.help('#unprotected')} WebSockets.`,\n    '',\n  ]);\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport m from '../../types/m/m.js';\n\nconst disclaimer = [\n  m.h2('!!! Follow at your own risk !!!'),\n  '',\n  'Disabling security is generally a bad idea and you should only do it if you understand the implications.',\n];\n\nexport default function firefoxPage() {\n  return ([\n    m.h1('Insecure WebSocket Access in Firefox'),\n    '',\n    m.line`Firefox lets you disable the security feature that prevents you from connecting to ${m.help('#unprotected')} WebSockets.`,\n    '',\n  ]).concat(disclaimer).concat([\n    '',\n    m.h2('Instructions'),\n    '',\n    '1. Go to about:config',\n    '2. Search for WebSocket',\n    '3. Set allowInsecureFromHTTPS to true',\n    '',\n  ]);\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport m from '../../types/m/m.js';\n\nconst gaSection = m.paragraph(\n  m.line`We use ${m.link('https://www.google.com/analytics/', 'Google Analytics')} to collect information about DWST usage.`,\n  'The main motivation is to collect statistical information to aid us develop and promote the software.',\n);\n\nconst disableTracking = m.paragraph(\n  'There are several ways to disable tracking.',\n  m.line`You could use some browser extension that blocks Google Analytics or you could use the ${m.help('#local')} DWST server which should have Google Analytics disabled.`,\n);\n\nconst storageSection = m.paragraph(\n  'Google Analytics stores some information in cookies.',\n  'DWST itself uses local storage for storing command history.',\n  m.line`You may use the built-in ${m.help('forget')} command to quickly remove stored command history.`,\n  'Consider using tools provided by your browser for more serious cleaning.',\n);\n\nconst futureChanges = m.paragraph(\n  'This describes how we do things today.',\n  'Check this page again sometime for possible updates on privacy and tracking considerations.',\n);\n\nexport default function privacyPage() {\n\n  return [\n    m.h1('Privacy and Tracking Information'),\n    '',\n    gaSection,\n    '',\n    disableTracking,\n    '',\n    storageSection,\n    '',\n    futureChanges,\n    '',\n  ];\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport m from '../../types/m/m.js';\nimport errors from '../../types/errors/errors.js';\nconst {UnknownCommand, UnknownHelpPage, UnknownInstruction} = errors;\n\nimport chromePage from './_chrome.js';\nimport commandsPage from './_commands.js';\nimport developmentPage from './_development.js';\nimport localPage from './_local.js';\nimport firefoxPage from './_firefox.js';\nimport functionsPage from './_functions.js';\nimport introductionPage from './_introduction.js';\nimport mainPage from './_main.js';\nimport privacyPage from './_privacy.js';\nimport styleguidePage from './_styleguide.js';\nimport simulatorPage from './_simulator.js';\nimport unprotectedPage from './_unprotected.js';\n\nconst topicMap = {\n  '#firefox': '#unprotected',\n  '#chrome': '#unprotected',\n  '#local': '#development',\n  '#styleguide': '#development',\n  '#simulator': '#development',\n};\n\nfunction *crumbSections(section) {\n\n  // first crumb\n  yield '#help';\n  if (section === '#help') {\n    return;\n  }\n\n  // optional middle crumb\n  if (topicMap.hasOwnProperty(section)) {\n    yield  topicMap[section];\n  } else if (section.endsWith('()')) {\n    yield '#functions';\n  } else if (section.startsWith('#') === false) {\n    yield '#commands';\n  }\n\n  // last crumb\n  yield section;\n}\n\nfunction createBreadCrumbs(section = '#help') {\n  return [...crumbSections(section)].flatMap(crumbText => [\n    m.unsafe(' &raquo; '),\n    m.help(crumbText),\n  ]).slice(1);\n}\n\nexport default class Help {\n\n  constructor(dwst) {\n    this._dwst = dwst;\n  }\n\n  _helpPage(section) {\n    if (section === '#help') {\n      return mainPage();\n    }\n    if (section === '#chrome') {\n      return chromePage();\n    }\n    if (section === '#firefox') {\n      return firefoxPage();\n    }\n    if (section === '#development') {\n      return developmentPage();\n    }\n    if (section === '#local') {\n      return localPage();\n    }\n    if (section === '#styleguide') {\n      return styleguidePage();\n    }\n    if (section === '#simulator') {\n      return simulatorPage();\n    }\n    if (section === '#unprotected') {\n      return unprotectedPage();\n    }\n    if (section === '#privacy') {\n      return privacyPage();\n    }\n    if (section === '#introduction') {\n      return introductionPage();\n    }\n    if (section === '#commands') {\n      const commands = this._dwst.plugins.getNames();\n      return commandsPage(commands);\n    }\n    if (section === '#functions') {\n      const functions = this._dwst.model.variables.getFunctionNames();\n      return functionsPage(functions);\n    }\n    throw new UnknownHelpPage(section);\n  }\n\n  _commandHelp(command) {\n    const plugin = this._dwst.plugins.getPlugin(command);\n    if (plugin === null) {\n      throw new UnknownCommand(command);\n    }\n    if (typeof plugin.usage === 'undefined') {\n      throw new UnknownHelpPage(command);\n    }\n    const usage = plugin.usage().map(m.syntax);\n    const examples = plugin.examples().map(m.command);\n\n    return ([\n      [\n        m.h1(command),\n        m.unsafe(' &ndash; '),\n        plugin.info(),\n      ],\n      '',\n      '',\n      m.h2('Syntax'),\n      '',\n    ]).concat(usage).concat([\n      '',\n      m.h2('Examples'),\n      '',\n    ]).concat(examples).concat([\n      '',\n    ]);\n  }\n\n  _functionHelp(section) {\n    const funcName = section.slice(0, -'()'.length);\n    const func = this._dwst.model.variables.getFunction(funcName);\n    if (func === null) {\n      throw new UnknownInstruction(funcName);\n    }\n    if (typeof func.usage === 'undefined') {\n      throw new UnknownHelpPage(funcName);\n    }\n    const usage = func.usage().map(m.syntax);\n    const examples = func.examples().map(m.command);\n\n    return ([\n      [\n        m.h1(section),\n        m.regular(' &ndash; ', true),\n        func.info(),\n      ],\n      '',\n      '',\n      m.h2('Syntax'),\n      '',\n    ]).concat(usage).concat([\n      '',\n      m.h2('Examples'),\n      '',\n    ]).concat(examples).concat([\n      '',\n    ]);\n  }\n\n  _pageContent(section) {\n    if (section.startsWith('#')) {\n      return this._helpPage(section);\n    }\n    if (section.endsWith('()')) {\n      return this._functionHelp(section);\n    }\n    return this._commandHelp(section);\n  }\n\n  page(section) {\n    const content = this._pageContent(section);\n    if (content === null) {\n      return null;\n    }\n    return ([\n      createBreadCrumbs(section),\n      '',\n    ]).concat(content);\n  }\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport m from '../../types/m/m.js';\n\nexport default function mainPage() {\n\n  return [\n    m.h1('Help Pages'),\n    '',\n    m.line`- ${m.help('#introduction')} for beginners`,\n    m.line`- Working with ${m.help('#unprotected')} sockets`,\n    m.line`- ${m.help('#privacy')} and tracking information`,\n    m.line`- Alphabetical list of ${m.help('#commands')}`,\n    m.line`- Alphabetical list of ${m.help('#functions')}`,\n    m.line`- DWST ${m.help('#development')}`,\n    '',\n    m.line`Open with ${m.syntax('/help #<keyword>')}`,\n    '',\n  ];\n}\n\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport m from '../../types/m/m.js';\n\nexport default function developmentPage() {\n  return [\n    m.h1('DWST Development'),\n    '',\n    m.line`- Run the ${m.help('#local')} development server`,\n    m.line`- User interface ${m.help('#styleguide')}`,\n    m.line`- WebSocket server ${m.help('#simulator')}`,\n  ];\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport m from '../../types/m/m.js';\n\nexport default function styleguidePage() {\n  return [\n    m.h1('Living Styleguide'),\n    '',\n    m.paragraph(\n      m.line`DWST is built out of custom built user interface elements which are documented in the ${m.link('/styleguide', 'living styleguide')}.`,\n      'The styleguide is generated automatically from KSS metadata which is included in related CSS files.',\n    ),\n  ];\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport m from '../../types/m/m.js';\n\nexport default function simulatorPage() {\n  return [\n    m.h1('Server Simulator'),\n    '',\n    m.paragraph(\n      'The built-in server simulator can be used for manual testing of dwst itself.',\n      'It exists so dwst developers do not have to setup or burden test servers.',\n      'It can be used for offline testing since it does not use the network.',\n    ),\n    '',\n    m.h2('Modes'),\n    '',\n    m.command('/connect dwst://echo'),\n    'returns sent messages back to you',\n    '',\n    m.command('/connect dwst://flood'),\n    'creates a flood of incoming messages',\n  ];\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport m from '../../types/m/m.js';\n\nexport default function unprotectedPage() {\n  return [\n    m.h1('Working with Unprotected WebSockets'),\n    '',\n    m.paragraph(\n      'Browsers tend to prevent unprotected WebSockets connections from secure origins.',\n      m.line`You may encounter this problem if your target WebSocket address starts with ${m.strong('ws://')}`,\n    ),\n    '',\n    m.h2('Use wss INSTEAD'),\n    '',\n    m.paragraph(\n      'The most straight forward fix is to use the secure address instead.',\n      'However, the server needs to accept secure connections for this to work.',\n    ),\n    '',\n    m.h2('Use Dev Server'),\n    '',\n    m.paragraph(\n      'The connection restrictions apply to DWST since it is served over https.',\n      m.line`You can work around the problem by setting up ${m.help('#local')} DWST server on your workstation.`,\n    ),\n    '',\n    m.h2('Disable Security'),\n    '',\n    m.paragraph(\n      'Finally, you have the option of disabling related browser security features.',\n      'However, doing this will screw up your security and release testing.',\n      m.line`Nevertheless we have instructions for ${m.help('#chrome')} and ${m.help('#firefox')}.`,\n    ),\n    '',\n  ];\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport m from '../../types/m/m.js';\n\nexport default function introductionPage() {\n\n  return [\n    m.h1('Introduction for Beginners'),\n    '',\n    'DWST is used to manually interact with a WebSocket server.',\n    '',\n    m.h2('The Very Basics'),\n    '',\n    m.paragraph(\n      m.line`Use the ${m.help('connect')} command to establish a connection.`,\n      'Type in text to send messages.',\n      m.line`End the connection with the ${m.help('disconnect')} command when you are done.`,\n    ),\n    '',\n    m.h2('Convenience Tools'),\n    '',\n    m.paragraph(\n      m.line`Use the ${m.help('send')} and ${m.help('binary')} commands to construct more complex messages.`,\n      m.line`Setup a periodic send with the ${m.help('interval')} command or send a burst of messages with the ${m.help('spam')} command.`,\n    ),\n    '',\n    m.h2('In Case of Emergency'),\n    '',\n    m.paragraph(\n      m.line`Use the ${m.strong('escape key')} for an emergency shutdown if you feel that things are spinning out of control.`,\n      m.line`Click on the DWST logo or use the ${m.help('splash')} command if you get lost.`,\n    ),\n    '',\n  ];\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport m from '../../types/m/m.js';\n\nexport default function commandsPage(commands) {\n\n  const longNames = commands.filter(name => name.length > 1);\n\n  return ([\n    m.h1('Alphabetical List of Commands'),\n    '',\n    m.sectionList(longNames),\n    m.line`Type ${m.syntax('/help <command>')} for usage`,\n    '',\n  ]);\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport m from '../../types/m/m.js';\n\nexport default function functionsPage(functions) {\n\n  const sections = functions.map(funcName => `${funcName}()`);\n\n  return ([\n    m.h1('Alphabetical List of Functions'),\n    '',\n    m.sectionList(sections),\n    m.line`Type ${m.syntax('/help <function>')} for usage`,\n    '',\n  ]);\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport config from './config.js';\nimport History from './history.js';\nimport Variables from './variables.js';\nimport Help from './help/help.js';\n\nexport default class Model {\n\n  constructor(dwst, history, save, functions) {\n    this.config = config;\n    this.history = new History(history, {save});\n    this.help = new Help(dwst);\n    this.connection = null;\n    this.intervalId = null;\n    this.variables = new Variables(dwst, functions);\n  }\n\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nexport default function renderTime(contentOnly = false) {\n  const addzero = function (i) {\n    if (i < 10) {\n      return `0${i}`;\n    }\n    return String(i);\n  };\n  const date = new Date();\n  const content = `${addzero(date.getHours())}:${addzero(date.getMinutes())}<span class=\"dwst-time__sec\">:${addzero(date.getSeconds())}</span>`;\n\n  if (contentOnly) {\n    return content;\n  }\n\n  const time = document.createElement('span');\n  time.setAttribute('class', 'dwst-time');\n  time.innerHTML = content;\n\n  return time;\n\n}\n\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport m from '../../types/m/m.js';\nimport utils from '../../lib/utils.js';\n\nfunction hexify(num) {\n  const hex = num.toString(16);\n  if (hex.length < 2) {\n    return `0${hex}`;\n  }\n  return hex;\n}\n\nfunction charify(num) {\n  if (num > 0x7e || num < 0x20) { // non-printable\n    return '.';\n  }\n  return String.fromCharCode(num);\n}\n\nfunction *hexdump(buffer) {\n  const dv = new DataView(buffer);\n  let offset = 0;\n  while (offset < buffer.byteLength) {\n    let text = '';\n    const hexes = [];\n    for (let i = 0; i < 16; i++) {\n      if (offset < buffer.byteLength) {\n        const oneByte = dv.getUint8(offset);\n        const asChar = charify(oneByte);\n        const asHex = hexify(oneByte);\n        text += asChar;\n        hexes.push(asHex);\n      }\n      offset += 1;\n    }\n    yield [hexes, text];\n\n  }\n}\n\nfunction hexLines(buffer) {\n  return [...hexdump(buffer)].map(lineData => m.hexline(...lineData));\n}\n\nfunction renderSegment(rawSegment, linkHandlers) {\n\n  const segment = (() => {\n    if (typeof rawSegment === 'string') {\n      return m.regular(rawSegment);\n    }\n    return rawSegment;\n  })();\n\n  if (typeof segment !== 'object') {\n    throw new Error('invalid segment');\n  }\n\n  const rawText = segment.text;\n  const safeText = (() => {\n    if (segment.hasOwnProperty('unsafe') && segment.unsafe === true) {\n      return rawText;\n    }\n    return utils.htmlescape(rawText);\n  })();\n\n  if (segment.type === 'regular') {\n    const textSpan = document.createElement('span');\n    textSpan.innerHTML = safeText;\n    return textSpan;\n  }\n  if (segment.type === 'help') {\n    const linkWrapper = document.createElement('span');\n    const linkWrapperClasses = ['dwst-mlog__help-link-wrapper'];\n    if (segment.wrap === false) {\n      linkWrapperClasses.push('dwst-mlog__help-link-wrapper--nowrap');\n    }\n    linkWrapper.setAttribute('class', linkWrapperClasses.join(' '));\n    const link = document.createElement('a');\n    const classes = ['dwst-mlog__help-link'];\n    if (segment.spacing === true) {\n      classes.push('dwst-mlog__help-link--spacing');\n    }\n    if (segment.warning === true) {\n      classes.push('dwst-mlog__help-link--warning');\n    }\n    link.setAttribute('class', classes.join(' '));\n    const command = `/help ${segment.section}`;\n    link.onclick = (evt => {\n      evt.preventDefault();\n      linkHandlers.onHelpLinkClick(command);\n    });\n    link.setAttribute('href', '#');\n    link.setAttribute('title', command);\n    const textSpan = document.createElement('span');\n    textSpan.innerHTML = safeText;\n    link.appendChild(textSpan);\n    linkWrapper.appendChild(link);\n    if (segment.afterText !== null) {\n      const afterTextNode = document.createTextNode(segment.afterText);\n      linkWrapper.appendChild(afterTextNode);\n    }\n    return linkWrapper;\n  }\n  if (segment.type === 'command') {\n    const link = document.createElement('a');\n    link.setAttribute('class', 'dwst-mlog__command-link');\n    const command = rawText;\n    link.onclick = (evt => {\n      evt.preventDefault();\n      linkHandlers.onCommandLinkClick(command);\n    });\n    link.setAttribute('href', '#');\n    link.setAttribute('title', safeText);\n    const textSpan = document.createElement('span');\n    textSpan.innerHTML = safeText;\n    link.appendChild(textSpan);\n    return link;\n  }\n  if (segment.type === 'hexline') {\n    const hexChunks = utils.chunkify(segment.hexes, 4);\n    const textChunks = utils.chunkify(rawText, 4);\n\n    const byteGrid = document.createElement('span');\n    const byteGridClasses = ['dwst-byte-grid'];\n    if (hexChunks.length < 3) {\n      byteGridClasses.push('dwst-byte-grid--less-than-three');\n    }\n    byteGrid.setAttribute('class', byteGridClasses.join(' '));\n\n    const chunksWanted = 4;\n    const chunkLength = 4;\n    [...Array(chunksWanted).keys()].forEach(i => {\n      const [hexChunk = []] = [hexChunks[i]];\n      const [textChunk = []] = [textChunks[i]];\n\n      const hexContent = utils.htmlescape(hexChunk.join(' '));\n      const hexItem = document.createElement('span');\n      hexItem.setAttribute('class', 'dwst-byte-grid__item');\n      hexItem.innerHTML = hexContent;\n      byteGrid.appendChild(hexItem);\n\n      const textContent = utils.htmlescape(textChunk.join('').padEnd(chunkLength));\n      const textItem = document.createElement('span');\n      textItem.setAttribute('class', 'dwst-byte-grid__item');\n      textItem.innerHTML = textContent;\n      byteGrid.appendChild(textItem);\n    });\n\n    const textSpan = document.createElement('span');\n    textSpan.setAttribute('class', 'dwst-mlog__hexline');\n    textSpan.appendChild(byteGrid);\n    return textSpan;\n  }\n  if (segment.type === 'code') {\n    const textSpan = document.createElement('span');\n    textSpan.setAttribute('class', 'dwst-mlog__code');\n    textSpan.innerHTML = safeText;\n    return textSpan;\n  }\n  if (segment.type === 'control') {\n    const textSpan = document.createElement('span');\n    textSpan.setAttribute('class', 'dwst-mlog__control');\n    textSpan.innerHTML = safeText;\n    textSpan.setAttribute('title', segment.title);\n    return textSpan;\n  }\n  if (segment.type === 'strong') {\n    const textSpan = document.createElement('span');\n    textSpan.setAttribute('class', 'dwst-mlog__strong');\n    textSpan.innerHTML = safeText;\n    return textSpan;\n  }\n  if (segment.type === 'h1') {\n    const textSpan = document.createElement('span');\n    textSpan.setAttribute('class', 'dwst-mlog__h1');\n    textSpan.innerHTML = safeText;\n    return textSpan;\n  }\n  if (segment.type === 'h2') {\n    const textSpan = document.createElement('span');\n    textSpan.setAttribute('class', 'dwst-mlog__h2');\n    textSpan.innerHTML = safeText;\n    return textSpan;\n  }\n  if (segment.type === 'syntax') {\n    const textSpan = document.createElement('span');\n    textSpan.setAttribute('class', 'dwst-mlog__syntax');\n    textSpan.innerHTML = safeText;\n    return textSpan;\n  }\n  if (segment.type === 'link') {\n    const textSpan = document.createElement('a');\n    textSpan.setAttribute('href', segment.url);\n    textSpan.setAttribute('target', '_blank');\n    textSpan.setAttribute('rel', 'noopener');\n    textSpan.setAttribute('class', 'dwst-mlog__link');\n    textSpan.innerHTML = safeText;\n    return textSpan;\n  }\n\n  throw new Error('unknown segment type');\n}\n\nfunction getLineSegments(line) {\n  if (typeof line === 'string') {\n    return [line];\n  } else if (typeof line === 'object' && !Array.isArray(line)) {\n    return [line];\n  }\n  if (!Array.isArray(line)) {\n    throw new Error('error');\n  }\n  return line;\n}\n\nexport default function renderMlog(sections, type, linkHandlers, options) {\n\n  const domSections = sections.map(section => {\n    const lines = [];\n    if (section instanceof ArrayBuffer) {\n      lines.push(...hexLines(section));\n    } else {\n      lines.push(section);\n    }\n    const domLines = lines.map(line => {\n      const segments = getLineSegments(line);\n      const domSegments = segments.map(segment => renderSegment(segment, linkHandlers));\n      return domSegments;\n    });\n    return domLines;\n  });\n  const outputCell = document.createElement('span');\n  outputCell.classList.add('dwst-mlog');\n  if (options.textData) {\n    outputCell.classList.add('dwst-mlog--text-data');\n  }\n  if (options.truncated) {\n    outputCell.classList.add('dwst-mlog--truncated');\n  }\n  domSections.forEach(domSection => {\n    domSection.forEach(domLine => {\n      domLine.forEach(domSegment => {\n        outputCell.appendChild(domSegment);\n      });\n      const br = document.createElement('br');\n      br.setAttribute('class', 'dwst-mlog__br');\n      outputCell.appendChild(br);\n    });\n  });\n  return outputCell;\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport renderTime from './time.js';\nimport renderDirection from './direction.js';\nimport renderMlog from './mlog.js';\n\nexport default function renderLogEntry(mlog, type, linkHandlers, options) {\n  const time = renderTime();\n  const direction = renderDirection(type);\n  const content = renderMlog(mlog, type, linkHandlers, options);\n\n  const logEntry = document.createElement('span');\n  logEntry.setAttribute('class', 'dwst-log-entry');\n\n  const timeCell = document.createElement('span');\n  timeCell.setAttribute('class', 'dwst-log-entry__time');\n  timeCell.appendChild(time);\n\n  const directionCell = document.createElement('span');\n  directionCell.setAttribute('class', 'dwst-log-entry__direction');\n  directionCell.appendChild(direction);\n\n  const contentCell = document.createElement('span');\n  contentCell.setAttribute('class', 'dwst-log-entry__content');\n  contentCell.appendChild(content);\n\n  logEntry.appendChild(timeCell);\n  logEntry.appendChild(directionCell);\n  logEntry.appendChild(contentCell);\n\n  return logEntry;\n}\n\n\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nexport default function renderDirection(type) {\n\n  const direction = document.createElement('span');\n  direction.setAttribute('class', `dwst-direction dwst-direction--${type}`);\n  direction.innerHTML = `${type}:`;\n\n  return direction;\n\n}\n\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport parseControlChars from '../../lib/control.js';\nimport m from '../../types/m/m.js';\n\nimport renderLogEntry from '../renderers/log_entry.js';\nimport renderGfx from '../renderers/gfx.js';\n\nfunction createLines(mlogItems) {\n  const CR = '\\\\r';\n  const LF = '\\\\n';\n  const lines = [];\n  let line = [];\n  let previous = null;\n  for (const part of mlogItems) {\n    if (previous === null) {\n      line.push(part);\n      if (typeof part === 'object') {\n        if (part.text === CR) {\n          previous = CR;\n        }\n        if (part.text === LF) {\n          previous = LF;\n        }\n      }\n    } else if (previous === CR) {\n      if (typeof part === 'string') {\n        lines.push(line);\n        line = [];\n        line.push(part);\n        previous = null;\n      } else  if (part.text === CR) {\n        lines.push(line);\n        line = [];\n        line.push(part);\n        previous = CR;\n      } else if (part.text === LF) {\n        line.push(part);\n        lines.push(line);\n        line = [];\n        previous = null;\n      } else {\n        lines.push(line);\n        line = [];\n        line.push(part);\n        previous = null;\n      }\n    } else if (previous === LF) {\n      if (typeof part === 'string') {\n        lines.push(line);\n        line = [];\n        line.push(part);\n        previous = null;\n      } else  if (part.text === CR) {\n        line.push(part);\n        lines.push(line);\n        line = [];\n        previous = null;\n      } else if (part.text === LF) {\n        lines.push(line);\n        line = [];\n        line.push(part);\n        previous = LF;\n      } else {\n        lines.push(line);\n        line = [];\n        line.push(part);\n        previous = null;\n      }\n    }\n  }\n  lines.push(line);\n  return lines;\n}\n\nfunction partToMlog(part) {\n  const text = (() => {\n    if (part.nice !== null) {\n      return part.nice;\n    }\n    const charCode = part.chr.charCodeAt(0);\n    if (charCode < 0x80) {\n      const charHex = `0${charCode.toString(16)}`.slice(-2);\n      return `\\\\x${charHex}`;\n    }\n    return `\\\\u{${charCode.toString(16)}}`;\n  })();\n  const title = `${text} - ${part.name} (${part.abbr})`;\n  return m.control(text, title);\n}\n\nfunction hilightControlChars(msg) {\n  const parts = parseControlChars(msg);\n  const mlogItems = parts.map(part => {\n    if (typeof part === 'object') {\n      return partToMlog(part);\n    }\n    return part;\n  });\n  const lines = createLines(mlogItems);\n  return lines;\n}\n\nexport default class Terminal {\n\n  constructor(element, dwst) {\n    this._element = element;\n    this._dwst = dwst;\n    this._limit = 1000;\n  }\n\n  reset() {\n    this._element.innerHTML = '';\n  }\n\n  _addLogItem(logLine) {\n    const userWasScrolling = this._dwst.ui.screen.isUserScrolling();\n    this._element.appendChild(logLine);\n    while (this._element.childElementCount > this._limit) {\n      this._element.removeChild(this._element.firstChild);\n    }\n    if (userWasScrolling) {\n      return;\n    }\n    this._dwst.ui.screen.scrollLog();\n  }\n\n  clearLog() {\n    const logClear = document.createElement('div');\n    logClear.setAttribute('class', 'dwst-log__clear');\n    this._addLogItem(logClear);\n  }\n\n  gfx(lines, colors) {\n    const gfx = renderGfx(lines, colors);\n\n    const item = document.createElement('div');\n    item.setAttribute('class', 'dwst-log__item dwst-log__item--gfx');\n    item.appendChild(gfx);\n\n    this._addLogItem(item);\n    this._dwst.ui.updateGfxPositions();\n  }\n\n  mlog(mlogDescription, type, userOptions) {\n\n    const options = Object.assign({\n      textData: false,\n      truncated: false,\n    }, userOptions);\n\n    const logLine = renderLogEntry(mlogDescription, type, this._dwst.controller.link, options);\n\n    const item = document.createElement('div');\n    item.setAttribute('class', `dwst-log__item dwst-log__item--${type}`);\n    item.appendChild(logLine);\n\n    this._addLogItem(item);\n  }\n\n  log(line, type) {\n    this.mlog([line], type);\n  }\n\n  blog(buffer, type) {\n    const size = buffer.byteLength;\n    const limit = 2 ** 10;\n    let truncated;\n    let view;\n    if (size > limit) {\n      view = buffer.slice(0, limit);\n      truncated = true;\n    } else {\n      view = buffer;\n      truncated = false;\n    }\n    this.mlog([\n      `<${buffer.byteLength}B of binary data>`,\n      view,\n    ], type, {truncated});\n    if (truncated) {\n      this.log(`User interface limit exceeded! Showing ${limit}B of the ${size}B buffer.`, 'warning');\n    }\n  }\n\n  tlog(msg, type) {\n    const size = msg.length;\n    const limit = 2 ** 12;\n    let truncated;\n    let view;\n    if (size > limit) {\n      view = msg.slice(0, limit);\n      truncated = true;\n    } else {\n      view = msg;\n      truncated = false;\n    }\n    const mlogDescription = hilightControlChars(view);\n    this.mlog(mlogDescription, type, {textData: true, truncated});\n    if (truncated) {\n      this.log(`User interface limit exceeded! Showing ${limit} of ${size} characters.`, 'warning');\n    }\n  }\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nexport default function renderGfx(lines, colors) {\n\n  const gfxContent = document.createElement('div');\n  gfxContent.setAttribute('class', 'dwst-gfx__content');\n  lines.forEach((line, li) => {\n    const logLine = document.createElement('div');\n    logLine.setAttribute('class', 'dwst-gfx__line');\n    [...line].forEach((chr, ci) => {\n      const color = colors[li][ci];\n      const outputCell = document.createElement('span');\n      outputCell.setAttribute('class', `dwst-gfx__element dwst-gfx__element--color-${color}`);\n      outputCell.innerHTML = chr;\n      logLine.appendChild(outputCell);\n    });\n    gfxContent.appendChild(logLine);\n  });\n  const background = document.createElement('div');\n  background.setAttribute('class', 'dwst-gfx__background');\n  const safe = document.createElement('div');\n  safe.setAttribute('class', 'dwst-debug__background-guide');\n  const safeco = document.createElement('div');\n  safeco.setAttribute('class', 'dwst-debug__content-guide');\n  safe.appendChild(safeco);\n  background.appendChild(safe);\n  gfxContent.appendChild(background);\n\n  const gfxContainer = document.createElement('div');\n  gfxContainer.setAttribute('class', 'dwst-gfx');\n  gfxContainer.setAttribute('aria-hidden', 'true');\n  gfxContainer.appendChild(gfxContent);\n\n  return gfxContainer;\n}\n\n\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport renderTime from '../renderers/time.js';\n\nexport default class Clock {\n\n  constructor(element, dwst) {\n    this._element = element;\n    this._dwst = dwst;\n  }\n\n  refreshClock() {\n    this._element.innerHTML = renderTime(true);\n  }\n\n  startClock() {\n    this.refreshClock();\n    this._element.classList.remove('dwst-time--placeholder');\n    setInterval(() => this.refreshClock(), 500);\n  }\n\n  onLoad() {\n    this.startClock();\n  }\n\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n           William Orr, US 2012\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport m from '../../types/m/m.js';\n\nimport parser from '../../lib/parser.js';\nconst {escapeForTemplateExpression} = parser;\n\nexport default class Prompt {\n\n  constructor(element, dwst) {\n    this._element = element;\n    this._dwst = dwst;\n  }\n\n  _enableDebugger() {\n    // TODO: refactor debugger to regular plugin\n    document.documentElement.classList.add('dwst-debug--guides');\n  }\n\n  send() {\n    const raw = this._element.value;\n    this._element.value = '';\n    this._dwst.model.history.select(raw);\n    if (raw === '/idkfa') {\n      this._enableDebugger();\n      return;\n    }\n    if (raw.length < 1) {\n      this._dwst.ui.terminal.mlog([\n        m.line`type ${m.command('/help')} to list available commands`,\n      ], 'system');\n      return;\n    }\n    if (raw[0] === '/') {\n      this._dwst.controller.prompt.loud(raw);\n      return;\n    }\n    const text = escapeForTemplateExpression(raw);\n    const command = `/send ${text}`;\n    this._dwst.controller.prompt.loud(command);\n  }\n\n  _keyHandler(event) {\n    if (event.keyCode === 13) {\n      this.send();\n    } else if (event.keyCode === 38) { // up\n      this._element.value = this._dwst.model.history.getPrevious(this._element.value);\n      return;\n    } else if (event.keyCode === 40) { // down\n      this._element.value = this._dwst.model.history.getNext(this._element.value);\n      return;\n    }\n  }\n\n  offerConnect() {\n    if (this._element.value === '') {\n      const connects = this._dwst.model.history.getConnectCommands(1);\n      if (connects.length < 1) {\n        this._element.value = `/connect ${this._dwst.model.config.echoServer}`;\n      } else {\n        this._element.value = connects[0];\n      }\n    } else {\n      this._dwst.model.history.select(this._element.value);\n      this._element.value = '';\n    }\n    this._element.focus();\n  }\n\n  init() {\n    this._element.addEventListener('keydown', evt => this._keyHandler(evt));\n  }\n\n  focus() {\n    this._element.focus();\n  }\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nexport default class SendButton {\n\n  constructor(element, dwst) {\n    this._element = element;\n    this._dwst = dwst;\n  }\n\n  init() {\n    this._element.addEventListener('click', () => {\n      this._dwst.ui.prompt.send();\n    });\n  }\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nexport default class MenuButton {\n\n  constructor(element, dwst) {\n    this._element = element;\n    this._dwst = dwst;\n  }\n\n  connected(state) {\n    if (state) {\n      this._element.classList.replace('dwst-button--splash', 'dwst-button--splash-connected');\n    } else {\n      this._element.classList.replace('dwst-button--splash-connected', 'dwst-button--splash');\n    }\n  }\n\n  init() {\n    this._element.addEventListener('click', () => {\n      this._dwst.controller.prompt.loud('/splash');\n      this._dwst.ui.screen.scrollLog();\n    });\n  }\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nexport default class Screen {\n\n  constructor(element, dwst) {\n    this._element = element;\n    this._dwst = dwst;\n  }\n\n  isUserScrolling() {\n    const errorMargin = 1;\n    // Some device pixel ratios create problems when errorMargin < 1.\n    // Try to use Windows 10 with 125%, 175% and 225% scaling.\n    const contentHeight = this._element.scrollHeight;\n    const visible = this._element.offsetHeight;\n    const invisible = contentHeight - visible;\n    const invisibleAbove = this._element.scrollTop;\n    const invisibleBelow = invisible - invisibleAbove;\n    return invisibleBelow > errorMargin;\n  }\n\n  scrollLog() {\n    this._element.scrollTop = this._element.scrollHeight;\n    this._dwst.ui.scrollNotification.hideScrollNotification();\n  }\n\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nexport default class AutoScrollButton {\n\n  constructor(element, dwst) {\n    this._element = element;\n    this._dwst = dwst;\n  }\n\n  init() {\n    this._element.addEventListener('click', evt => {\n      evt.preventDefault();\n      this._dwst.ui.screen.scrollLog();\n    });\n  }\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nexport default class ScrollNotification {\n\n  constructor(element, dwst) {\n    this._element = element;\n    this._dwst = dwst;\n  }\n\n  scrollNotificationUpdate() {\n    if (this._dwst.ui.screen.isUserScrolling()) {\n      this.showScrollNotification();\n      return;\n    }\n    this.hideScrollNotification();\n  }\n\n  showScrollNotification() {\n    this._element.removeAttribute('style');\n  }\n\n  hideScrollNotification() {\n    this._element.setAttribute('style', 'display: none;');\n  }\n\n  init() {\n    setInterval(() => this.scrollNotificationUpdate(), 1000);\n  }\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nexport default class FileInput {\n\n  constructor(element, dwst) {\n    this._element = element;\n    this._dwst = dwst;\n  }\n\n  read(callback) {\n    const upload = this._element.getElementsByTagName('input')[0];\n    upload.onchange = () => {\n      const file = upload.files[0];\n      this._element.innerHTML = this._element.innerHTML;\n      callback(file);\n    };\n    upload.click();\n  }\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport Terminal from './components/terminal.js';\nimport Clock from './components/clock.js';\nimport Prompt from './components/prompt.js';\nimport SendButton from './components/send_button.js';\nimport MenuButton from './components/menu_button.js';\nimport Screen from './components/screen.js';\nimport AutoScrollButton from './components/auto_scroll_button.js';\nimport ScrollNotification from './components/scroll_notification.js';\nimport FileInput from './components/file_input.js';\n\nexport default class Ui {\n\n  constructor(element, dwst) {\n    this._element = element;\n    this._dwst = dwst;\n    this._resizePending = false;\n\n    this.terminal = new Terminal(element.getElementById('js-terminal'), this._dwst);\n    this.clock = new Clock(element.getElementById('js-clock'), this._dwst);\n    this.prompt = new Prompt(element.getElementById('js-prompt'), this._dwst);\n    this.sendButton = new SendButton(element.getElementById('js-send-button'), this._dwst);\n    this.menuButton = new MenuButton(element.getElementById('js-menu-button'), this._dwst);\n    this.screen = new Screen(element.getElementById('js-screen'), this._dwst);\n    this.autoScrollButton = new AutoScrollButton(element.getElementById('js-auto-scroll-button'), this._dwst);\n    this.scrollNotification = new ScrollNotification(element.getElementById('js-scroll-notification'), this._dwst);\n    this.fileInput = new FileInput(element.getElementById('js-file-input'), this._dwst);\n  }\n\n  globalKeyPress(event) {\n    if (event.key === 'Escape') {\n      const connection = this._dwst.model.connection;\n      if (connection !== null && (connection.isOpen() || connection.isConnecting())) {\n        this._dwst.controller.prompt.loud('/disconnect');\n      } else {\n        this.prompt.offerConnect();\n      }\n    }\n  }\n\n  updateGfxPositions() {\n    // Updating gfx positions with this method disables basic centering\n    // and aligns the text in the gfx section with the text in log lines.\n    const MAX_MAXCHARS = 110;\n    Reflect.apply(Array.prototype.forEach, this._element.getElementsByClassName('dwst-gfx'), [maxDiv => {\n      const ref = maxDiv.getElementsByClassName('dwst-gfx__line')[0];\n      const refTextWidth = ref.offsetWidth;\n      const refTextLength = ref.textContent.length;\n      const refWidth = refTextWidth / refTextLength;\n      const windowWidth = window.innerWidth;\n      const maxFit = Math.floor(windowWidth / refWidth);\n      let leftMargin = 0;\n      if (maxFit < MAX_MAXCHARS) {\n        const invisible = MAX_MAXCHARS - maxFit;\n        const invisibleLeft = Math.round(invisible / 2);\n        leftMargin -= invisibleLeft;\n      }\n      const field = maxDiv.getElementsByClassName('dwst-gfx__content')[0];\n      field.setAttribute('style', `transform: initial; margin-left: ${leftMargin}ch;`);\n    }]);\n  }\n\n  _throttledUpdateGfxPositions() {\n    if (this._resizePending !== true) {\n      this._resizePending = true;\n      setTimeout(() => {\n        this._resizePending = false;\n        this.updateGfxPositions();\n      }, 100);\n    }\n  }\n\n  init() {\n    this._element.addEventListener('keydown', evt => this.globalKeyPress(evt));\n    this.prompt.init();\n    this.sendButton.init();\n    this.menuButton.init();\n    this.autoScrollButton.init();\n    this.scrollNotification.init();\n    this._dwst.controller.prompt.silent('/splash');\n    this.prompt.focus();\n    window.addEventListener('resize', () => this._throttledUpdateGfxPositions());\n  }\n\n  onLoad() {\n    this.clock.onLoad();\n    this.updateGfxPositions();\n  }\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nexport default class LinkHandler {\n\n  constructor(dwst) {\n    this._dwst = dwst;\n  }\n\n  onHelpLinkClick(command) {\n    this._dwst.controller.prompt.loud(command);\n  }\n\n  onCommandLinkClick(command) {\n    this._dwst.model.history.select(command);\n    this._dwst.controller.prompt.loud(command);\n  }\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport DwstFunction from '../types/abstract/function.js';\n\nexport default class TemplateHandler {\n\n  constructor(dwst) {\n    this._dwst = dwst;\n    this._encoder = new TextEncoder();\n  }\n\n  _evalFunction({name, args}) {\n    const func = this._dwst.model.variables.getVariable(name);\n    if (func === null) {\n      throw new this._dwst.types.errors.UnknownInstruction(name);\n    }\n    if (func instanceof DwstFunction) {\n      return func.run(args);\n    }\n    throw new this._dwst.types.errors.InvalidDataType(name, ['FUNCTION']);\n  }\n\n  async _evalParticle(particle) {\n    if (particle.type === 'text') {\n      return this._encoder.encode(particle.value);\n    }\n    if (particle.type === 'byte') {\n      const buffer = new Uint8Array([particle.value]);\n      return buffer;\n    }\n    if (particle.type === 'codepoint') {\n      const chr = String.fromCodePoint(particle.value);\n      return this._encoder.encode(chr);\n    }\n    if (particle.type === 'variable') {\n      const variableName = particle.name;\n      const value = this._dwst.model.variables.getVariable(variableName);\n      if (value instanceof ArrayBuffer) {\n        return new Uint8Array(value);\n      }\n      if (typeof value  === 'string') {\n        return this._encoder.encode(value);\n      }\n      if (value instanceof this._dwst.types.abstract.DwstFunction) {\n        throw new this._dwst.types.errors.InvalidDataType(variableName, ['STRING', 'BINARY']);\n      }\n      throw new this._dwst.types.errors.UnknownVariable(variableName);\n    }\n    if (particle.type === 'function') {\n      const output = await this._evalFunction(particle);\n      if (output.constructor === Uint8Array) {\n        return output;\n      }\n      if (typeof output === 'string') {\n        return this._encoder.encode(output);\n      }\n      throw new Error('unexpected function return type');\n    }\n    throw new Error('unexpected particle type');\n  }\n\n  async _evalTemplateExpression(templateExpression) {\n    const rootNode = this._dwst.lib.parser.parseTemplateExpression(templateExpression);\n    if (rootNode.type !== 'templateExpression') {\n      throw new Error('unexpected root node type');\n    }\n    const chunks = await Promise.all(rootNode.particles.map(particle => this._evalParticle(particle)));\n    const buffer = this._dwst.lib.utils.joinBuffers(chunks).buffer;\n    return buffer;\n  }\n\n  eval(templateExpression) {\n    return this._evalTemplateExpression(templateExpression);\n  }\n\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nexport default class PromptHandler {\n\n  constructor(dwst) {\n    this._dwst = dwst;\n  }\n\n  async _runPlugin(pluginName, paramString) {\n    const plugin = this._dwst.plugins.getPlugin(pluginName);\n    if (plugin === null) {\n      throw new this._dwst.types.errors.UnknownCommand(pluginName);\n    }\n    return plugin.run(paramString);\n  }\n\n  run(command) {\n    const [pluginName, ...params] = command.split(' ');\n    const paramString = params.join(' ');\n    this._runPlugin(pluginName, paramString).catch(error => {\n      // setTimeout used to escape promise\n      setTimeout(() => {\n        throw error;\n      });\n    });\n  }\n\n  silent(line) {\n    const noslash = line.substring(1);\n    this.run(noslash);\n  }\n\n  loud(line) {\n    this._dwst.ui.terminal.log(line, 'command');\n    this.silent(line);\n  }\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nexport default class SocketHandler {\n\n  constructor(dwst) {\n    this._dwst = dwst;\n  }\n\n  onConnectionOpen(protocol) {\n    const selected = (() => {\n      if (protocol.length < 1) {\n        return [];\n      }\n      return [`Selected protocol: ${protocol}`];\n    })();\n    this._dwst.ui.terminal.mlog(['Connection established.'].concat(selected), 'system');\n    this._dwst.ui.menuButton.connected(true);\n  }\n\n  onConnectionClose(e, sessionLength) {\n    const meanings = {\n      1000: 'Normal Closure',\n      1001: 'Going Away',\n      1002: 'Protocol error',\n      1003: 'Unsupported Data',\n      1005: 'No Status Rcvd',\n      1006: 'Abnormal Closure',\n      1007: 'Invalid frame payload data',\n      1008: 'Policy Violation',\n      1009: 'Message Too Big',\n      1010: 'Mandatory Ext.',\n      1011: 'Internal Server Error',\n      1015: 'TLS handshake',\n    };\n    const code = (() => {\n      if (meanings.hasOwnProperty(e.code)) {\n        return `${e.code} (${meanings[e.code]})`;\n      }\n      return `${e.code}`;\n    })();\n    const reason = (() => {\n      if (e.reason.length < 1) {\n        return [];\n      }\n      return [`Close reason: ${e.reason}`];\n    })();\n    const sessionLengthString = (() => {\n      if (sessionLength === null) {\n        return [];\n      }\n      return [`Session length: ${sessionLength}ms`];\n    })();\n    this._dwst.ui.terminal.mlog(['Connection closed.', `Close status: ${code}`].concat(reason).concat(sessionLengthString), 'system');\n    this._dwst.model.connection = null;\n    this._dwst.ui.menuButton.connected(false);\n  }\n\n  onMessage(msg) {\n    if (typeof msg === 'string') {\n      this._dwst.ui.terminal.tlog(msg, 'received');\n    } else {\n      const fr = new FileReader();\n      fr.addEventListener('load', evt => {\n        const buffer = evt.target.result;\n        this._dwst.ui.terminal.blog(buffer, 'received');\n      });\n      fr.readAsArrayBuffer(msg);\n    }\n  }\n\n  onError() {\n    this._dwst.ui.terminal.log('WebSocket error.', 'error');\n  }\n\n  beforeSendWhileConnecting(verb) {\n    this._dwst.ui.terminal.log(`Attempting to send data while ${verb}`, 'warning');\n  }\n\n  onSend(msg) {\n    if (typeof msg === 'string') {\n      this._dwst.ui.terminal.tlog(msg, 'sent');\n    } else {\n      this._dwst.ui.terminal.blog(msg, 'sent');\n    }\n  }\n}\n","/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\n\nimport m from '../types/m/m.js';\nimport errors from '../types/errors/errors.js';\nconst {NoConnection, AlreadyConnected, SocketError, InvalidTemplateExpression, InvalidArgument, InvalidCombination, InvalidUtf8, InvalidDataType, InvalidVariableName, UnknownCommand, UnknownInstruction, UnknownHelpPage, UnknownVariable} = errors;\n\nfunction commaCommaOr(stringList) {\n  if (stringList.length === 0) {\n    throw new Error('list has to have at least one item');\n  }\n  if (stringList.length === 1) {\n    return stringList[0];\n  }\n  const last = stringList[stringList.length - 1];\n  const listExcludingLast = stringList.slice(0, stringList.length - 1);\n  const upToSecondLastJoined = listExcludingLast.join(', ');\n  return `${upToSecondLastJoined} or ${last}`;\n}\n\nexport default class ErrorHandler {\n\n  constructor(dwst) {\n    this._dwst = dwst;\n  }\n\n  _errorToMLog(error) {\n    if (error instanceof NoConnection) {\n      return [\n        'No connection.',\n        `Cannot send: ${error.msg}`,\n        m.line`Use ${m.help('connect')} to form a connection and try again.`,\n      ];\n    }\n    if (error instanceof AlreadyConnected) {\n      return [\n        'Already connected to a server',\n        m.line`Type ${m.command('/disconnect')} to end the connection`,\n      ];\n    }\n    if (error instanceof SocketError) {\n      return [\n        'WebSocket error.',\n      ];\n    }\n    if (error instanceof InvalidTemplateExpression) {\n      const padding = ' '.repeat(error.errorPosition);\n      const expected = commaCommaOr(error.expected);\n      const got = error.remainder.charAt(0);\n      return [\n        'Invalid template.',\n        error.expression,\n        `${padding}^`,\n        `Expected ${expected}, but got \"${got}\" instead.`,\n      ];\n    }\n    if (error instanceof InvalidArgument) {\n      return [\n        `Invalid argument: ${error.argument}`,\n        error.extraInfo,\n      ];\n    }\n    if (error instanceof InvalidCombination) {\n      return [\n        m.line`Invalid ${m.help(error.command)} command combination.`,\n        `Compatible commands: ${error.commands.join(', ')}`,\n      ];\n    }\n    if (error instanceof InvalidUtf8) {\n      return [\n        `Utf-8 decoder failed to process ${error.buffer.byteLength}B buffer`,\n        `${error.buffer}`,\n      ];\n    }\n    if (error instanceof InvalidDataType) {\n      return [\n        `Variable ${error.variable} is not a ${commaCommaOr(error.expected)}`,\n      ];\n    }\n    if (error instanceof InvalidVariableName) {\n      return [\n        `Invalid variable name ${error.variable}`,\n      ];\n    }\n    if (error instanceof UnknownCommand) {\n      return [\n        m.line`Unknown command ${m.strong(error.command)}`,\n        m.line`Type ${m.command('/help #commands')} to list available commands`,\n      ];\n    }\n    if (error instanceof UnknownInstruction) {\n      return [\n        m.line`Unknown function ${m.strong(error.instruction)}`,\n        m.line`Type ${m.command('/help #functions')} to list available functions`,\n      ];\n    }\n    if (error instanceof UnknownHelpPage) {\n      return [\n        `Unkown help page: ${error.page}`,\n        m.line`Display help index by typing ${m.command('/help')}`,\n      ];\n    }\n    if (error instanceof UnknownVariable) {\n      return [\n        `Variable \"${error.variable}\" does not exist.`,\n        m.line`List available variables by typing ${m.command('/vars')}`,\n      ];\n    }\n\n    throw new Error(`missing error handler for ${error.constructor.name}`);\n  }\n\n  onDwstError(error) {\n    this._dwst.ui.terminal.mlog(this._errorToMLog(error), 'error');\n  }\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport m from '../types/m/m.js';\n\nexport default class PwaHandler {\n\n  constructor(dwst) {\n    this._dwst = dwst;\n    this._prompt = null;\n  }\n\n  beforeInstallPrompt(evt) {\n    this._prompt = evt;\n    this._dwst.ui.terminal.mlog([\n      m.line`Type ${m.command('/pwa install')} to install`,\n    ], 'system');\n  }\n\n  onInstall() {\n    if (this._prompt === null) {\n      this._dwst.ui.terminal.mlog([\n        'Installation not possible',\n        '',\n        'Possible reasons:',\n        '  * App already installed',\n        '  * App not frequently used',\n        '  * Browser has no PWA support',\n        '',\n        'You could try manual pwa installation with \"Add to home screen\" or similar browser feature',\n      ], 'warning');\n      return;\n    }\n    this._prompt.prompt();\n    this._prompt = null;\n  }\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport DwstFunction from '../types/abstract/function.js';\n\nexport default class ByteRange extends DwstFunction {\n\n  constructor(dwst) {\n    super();\n    this._dwst = dwst;\n  }\n\n  commands() {\n    return ['byteRange'];\n  }\n\n  usage() {\n    return [\n      'byteRange(<start>, <end>)',\n    ];\n  }\n\n  examples() {\n    return [\n      '/s From a to z: ${byteRange(97,122)}',\n      '/b ${byteRange(0,0xff)}',\n    ];\n  }\n\n  info() {\n    return 'generate sequential bytes';\n  }\n\n  run(args) {\n    let start = 0;\n    let end = 0xff;\n    if (args.length === 1) {\n      end = args[0].value;\n    }\n    if (args.length === 2) {\n      start = args[0].value;\n      end = args[1].value;\n    }\n    const bytes = [];\n    for (let i = start; i <= end; i++) {\n      bytes.push(i);\n    }\n    return new Uint8Array(bytes);\n  }\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport DwstFunction from '../types/abstract/function.js';\n\nexport default class CharRange extends DwstFunction {\n\n  constructor(dwst) {\n    super();\n    this._dwst = dwst;\n  }\n\n  commands() {\n    return ['charRange'];\n  }\n\n  usage() {\n    return [\n      'charRange(<start>, <end>)',\n    ];\n  }\n\n  examples() {\n    return [\n      '/s From a to z: ${charRange(97,122)}',\n      '/s ${charRange(0x2600,0x2603)}',\n      '/b ${charRange(0x2600,0x2603)}',\n    ];\n  }\n\n  info() {\n    return 'generate sequential utf-8 encoded characters';\n  }\n\n  run(args) {\n    let start = 32;\n    let end = 126;\n    if (args.length === 1) {\n      end = args[0].value;\n    }\n    if (args.length === 2) {\n      start = args[0].value;\n      end = args[1].value;\n    }\n    let str = '';\n    for (let i = start; i <= end; i++) {\n      str += String.fromCodePoint(i);\n    }\n    return str;\n  }\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport DwstFunction from '../types/abstract/function.js';\n\nexport default class File extends DwstFunction {\n\n  constructor(dwst) {\n    super();\n    this._dwst = dwst;\n  }\n\n  commands() {\n    return ['file'];\n  }\n\n  usage() {\n    return [\n      'file()',\n    ];\n  }\n\n  examples() {\n    return [\n      '/s ${file()}',\n      '/b ${file()}',\n      '/set foo ${file()}',\n    ];\n  }\n\n  info() {\n    return 'read file from filesystem';\n  }\n\n  _readFile() {\n    return new Promise(resolve => {\n      this._dwst.ui.fileInput.read(file => {\n        const reader = new FileReader();\n        reader.addEventListener('load', evt => {\n          const buffer = evt.target.result;\n          resolve(buffer);\n        });\n        reader.readAsArrayBuffer(file);\n      });\n    });\n  }\n\n  async run() {\n    const fileContents = await this._readFile();\n    return new Uint8Array(fileContents);\n  }\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport DwstFunction from '../types/abstract/function.js';\n\nexport default class RandomBytes extends DwstFunction {\n\n  constructor(dwst) {\n    super();\n    this._dwst = dwst;\n  }\n\n  commands() {\n    return ['randomBytes'];\n  }\n\n  usage() {\n    return [\n      'randomBytes(<number>)',\n    ];\n  }\n\n  examples() {\n    return [\n      '/b ${randomBytes(16)}',\n    ];\n  }\n\n  info() {\n    return 'generate random bytes';\n  }\n\n  run(args) {\n    const randombyte = () => {\n      const out = Math.floor(Math.random() * (0xff + 1));\n      return out;\n    };\n    let num = 16;\n    if (args.length === 1) {\n      num = args[0].value;\n    }\n    const bytes = [];\n    for (let i = 0; i < num; i++) {\n      bytes.push(randombyte());\n    }\n    return new Uint8Array(bytes);\n  }\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport DwstFunction from '../types/abstract/function.js';\n\nexport default class RandomChars extends DwstFunction {\n\n  constructor(dwst) {\n    super();\n    this._dwst = dwst;\n  }\n\n  commands() {\n    return ['randomChars'];\n  }\n\n  usage() {\n    return [\n      'randomChars(<number>)',\n    ];\n  }\n\n  examples() {\n    return [\n      '/s ${randomChars(10)}',\n      '/b ${randomChars(10)}',\n    ];\n  }\n\n  info() {\n    return 'generate random utf-8 encoded characters';\n  }\n\n  run(args) {\n    const randomchar = () => {\n      const out = Math.floor(Math.random() * (0xffff + 1));\n      const char = String.fromCodePoint(out);\n      return char;\n    };\n    let num = 16;\n    if (args.length === 1) {\n      num = args[0].value;\n    }\n    let str = '';\n    for (let i = 0; i < num; i++) {\n      str += randomchar();\n    }\n    return str;\n  }\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport DwstFunction from '../types/abstract/function.js';\n\nexport default class Time extends DwstFunction {\n\n  constructor(dwst) {\n    super();\n    this._dwst = dwst;\n  }\n\n  commands() {\n    return ['time'];\n  }\n\n  usage() {\n    return [\n      'time()',\n    ];\n  }\n\n  examples() {\n    return [\n      '/s ${time()}s since epoch',\n      '/b ${time()}',\n    ];\n  }\n\n  info() {\n    return 'generate utf-8 encoded timestamp';\n  }\n\n  run() {\n    return String(Math.round(new Date().getTime() / 1000));\n  }\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nclass FakeSocket {\n  constructor(url) {\n    this.url = url;\n    this.protocol = '';\n    this.readyState = 1;\n    this._path = url.split('//').pop();\n    this._nextFlood = null;\n    window.setTimeout(() => {\n      this.onopen();\n      if (this._path === 'flood') {\n        this._flood(0);\n      }\n    }, 0);\n  }\n\n  _flood(count) {\n    this._nextFlood = window.setTimeout(() => {\n      this.onmessage({\n        data: `${count}`,\n      });\n      this._flood(count + 1);\n    }, 0);\n  }\n\n  send(message) {\n    if (this._path === 'echo') {\n      const data = (() => {\n        if (typeof message === 'string') {\n          return message;\n        }\n        if (message instanceof ArrayBuffer) {\n          return new Blob([new Uint8Array(message)]);\n        }\n        throw new Error('Unexpected message type');\n      })();\n      window.setTimeout(() => {\n        this.onmessage({\n          data,\n        });\n      }, 0);\n    }\n  }\n\n  close() {\n    window.clearTimeout(this._nextFlood);\n    this.readyState = 3;\n    this.onclose({\n      code: 1000,\n      reason: '',\n    });\n  }\n}\n\nexport default class Connection {\n\n  constructor(url, protocols = [], controller) {\n    this._controller = controller;\n    this.sessionStartTime = null;\n    this.ws = (() => {\n      const SocketConstructor = (() => {\n        if (url.startsWith('dwst://')) {\n          return FakeSocket;\n        }\n        return WebSocket;\n      })();\n      if (protocols.length < 1) {\n        return new SocketConstructor(url);\n      }\n      return new SocketConstructor(url, protocols);\n    })();\n    this.ws.onopen = this._onopen.bind(this);\n    this.ws.onclose = this._onclose.bind(this);\n    this.ws.onmessage = this._onmessage.bind(this);\n    this.ws.onerror = this._onerror.bind(this);\n  }\n\n  _onopen() {\n    this.sessionStartTime = (new Date()).getTime();\n    this._controller.onConnectionOpen(this.ws.protocol);\n  }\n\n  _onclose(e) {\n    const sessionLength = (() => {\n      if (this.sessionStartTime === null) {\n        return null;\n      }\n      const currentTime = (new Date()).getTime();\n      return currentTime - this.sessionStartTime;\n    })();\n    this._controller.onConnectionClose(e, sessionLength);\n  }\n\n  _onmessage(msg) {\n    this._controller.onMessage(msg.data);\n  }\n\n  _onerror() {\n    this._controller.onError();\n  }\n\n  get url() {\n    return this.ws.url;\n  }\n\n  get verb() {\n    const readyState = this.ws.readyState;\n    if (readyState === 0) {\n      return 'connecting';\n    }\n    if (readyState === 1) {\n      return 'connected';\n    }\n    if (readyState === 2) {\n      return 'closing connection';\n    }\n    if (readyState === 3) {\n      return 'hanging on an already closed connection';\n    }\n    throw new Error('Unkown readyState');\n  }\n\n  get protocol() {\n    return this.ws.protocol;\n  }\n\n  send(...params) {\n    if (this.ws.readyState !== 1) {\n      this._controller.beforeSendWhileConnecting(this.verb);\n    }\n    this._controller.onSend(...params);\n    this.ws.send(...params);\n  }\n\n  close() {\n    this.ws.close();\n  }\n\n  isConnecting() {\n    return this.ws.readyState === 0;\n  }\n\n  isOpen() {\n    return this.ws.readyState === 1;\n  }\n\n  isClosing() {\n    return this.ws.readyState === 2;\n  }\n\n  isClosed() {\n    return this.ws.readyState === 3;\n  }\n\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n           William Orr, US 2012\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport lib from './lib/lib.js';\nimport types from './types/types.js';\nimport Model from './model/model.js';\nimport Ui from './ui/ui.js';\nimport Controller from './controller/controller.js';\nimport Plugins from './model/plugins.js';\n\nimport DwstError from './types/abstract/error.js';\n\nimport ByteRange from './functions/byte_range.js';\nimport CharRange from './functions/char_range.js';\nimport File from './functions/file.js';\nimport RandomBytes from './functions/random_bytes.js';\nimport RandomChars from './functions/random_chars.js';\nimport Time from './functions/time.js';\n\nimport Binary from './plugins/binary.js';\nimport Clear from './plugins/clear.js';\nimport Connect from './plugins/connect.js';\nimport Disconnect from './plugins/disconnect.js';\nimport Forget from './plugins/forget.js';\nimport Help from './plugins/help.js';\nimport Interval from './plugins/interval.js';\nimport Pwa from './plugins/pwa.js';\nimport Reset from './plugins/reset.js';\nimport Send from './plugins/send.js';\nimport Set from './plugins/set.js';\nimport Spam from './plugins/spam.js';\nimport Splash from './plugins/splash.js';\nimport Unset from './plugins/unset.js';\nimport Vars from './plugins/vars.js';\n\nfunction loadModel(dwst) {\n  const HISTORY_KEY = 'history';\n  const response = localStorage.getItem(HISTORY_KEY);\n  const save = function (history) {\n    const saveState = JSON.stringify(history);\n    localStorage.setItem(HISTORY_KEY, saveState);\n  };\n  let history = [];\n  if (response !== null) {\n    history = JSON.parse(response);\n  }\n  return new Model(dwst, history, save, [\n    ByteRange,\n    CharRange,\n    File,\n    RandomBytes,\n    RandomChars,\n    Time,\n  ]);\n}\n\nconst dwst = Object.seal({\n  lib,\n  types,\n  model: null,\n  ui: null,\n  controller: null,\n  plugins: null,\n  functions: null,\n});\n\ndwst.model = loadModel(dwst);\n\ndwst.controller = new Controller(dwst);\n\ndwst.plugins = new Plugins(dwst, [\n  Binary,\n  Clear,\n  Connect,\n  Disconnect,\n  Forget,\n  Help,\n  Interval,\n  Pwa,\n  Reset,\n  Send,\n  Set,\n  Spam,\n  Splash,\n  Unset,\n  Vars,\n]);\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  dwst.ui = new Ui(document, dwst);\n  dwst.ui.init();\n});\n\nwindow.addEventListener('load', () => {\n  dwst.ui.onLoad();\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.register('/service_worker.js');\n  }\n});\n\nwindow.addEventListener('error', evt => {\n  if (evt.error instanceof DwstError) {\n    evt.preventDefault();\n    dwst.controller.error.onDwstError(evt.error);\n  }\n});\n\nwindow.addEventListener('beforeinstallprompt', evt => {\n  dwst.controller.pwa.beforeInstallPrompt(evt);\n});\n\n\n// for live debugging\nwindow._dwst = dwst;\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport LinkHandler from './link.js';\nimport TemplateHandler from './template.js';\nimport PromptHandler from './prompt.js';\nimport SocketHandler from './socket.js';\nimport ErrorHandler from './error.js';\nimport PwaHandler from './pwa.js';\n\nexport default class Controller {\n\n  constructor(dwst) {\n    this.link = new LinkHandler(dwst);\n    this.template = new TemplateHandler(dwst);\n    this.prompt = new PromptHandler(dwst);\n    this.socket = new SocketHandler(dwst);\n    this.error = new ErrorHandler(dwst);\n    this.pwa = new PwaHandler(dwst);\n  }\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nexport default class Plugins {\n\n  constructor(dwst, pluginClasses) {\n    this._commands = new Map();\n    for (const Constructor of pluginClasses) {\n      const plugin = new Constructor(dwst);\n      for (const command of plugin.commands()) {\n        this._commands.set(command, plugin);\n      }\n    }\n  }\n\n  getPlugin(pluginName) {\n    const plugin = this._commands.get(pluginName);\n    if (typeof plugin === 'undefined') {\n      return null;\n    }\n    return plugin;\n  }\n\n  getNames() {\n    return [...this._commands.keys()];\n  }\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nexport default class Binary {\n\n  constructor(dwst) {\n    this._dwst = dwst;\n  }\n\n  commands() {\n    return ['binary', 'b'];\n  }\n\n  usage() {\n    return [\n      '/binary [template]',\n      '/b [template]',\n    ];\n  }\n\n  examples() {\n    return [\n      '/binary Hello world!',\n      '/binary [\"JSON\",\"is\",\"cool\"]',\n      '/binary multiline\\\\r\\\\nmessage',\n      '/binary null terminated string\\\\0one more\\\\0',\n      '/binary tab\\\\x09separated\\\\x09strings',\n      '/binary unicode snowman \\\\u2603',\n      '/binary unicode tea cup \\\\u{1f375}',\n      '/b Available now with ~71.43% less typing!',\n    ];\n  }\n\n  info() {\n    return 'send binary data';\n  }\n\n  async run(templateExpression) {\n    const buffer = await this._dwst.controller.template.eval(templateExpression);\n    const msg = `<${buffer.byteLength}B of data> `;\n    const connection = this._dwst.model.connection;\n    if (connection === null || connection.isClosing() || connection.isClosed()) {\n      throw new this._dwst.types.errors.NoConnection(msg);\n    }\n    this._dwst.model.connection.send(buffer);\n  }\n}\n\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nexport default class Clear {\n\n  constructor(dwst) {\n    this._dwst = dwst;\n  }\n\n  commands() {\n    return ['clear'];\n  }\n\n  usage() {\n    return [\n      '/clear',\n    ];\n  }\n\n  examples() {\n    return [\n      '/clear',\n    ];\n  }\n\n  info() {\n    return 'clear the screen';\n  }\n\n  run() {\n    this._dwst.ui.terminal.clearLog();\n  }\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nimport Connection from '../connection.js';\n\nexport default class Connect {\n\n  constructor(dwst) {\n    this._dwst = dwst;\n  }\n\n  commands() {\n    return ['connect'];\n  }\n\n  usage() {\n    return [\n      '/connect <ws-url> [p1[,p2[,...]]]',\n    ];\n  }\n\n  examples() {\n    return [\n      '/connect wss://echo.websocket.org/',\n      '/connect ws://echo.websocket.org/',\n      '/connect ws://127.0.0.1:1234/ protocol1.example.com,protocol2.example.com',\n    ];\n  }\n\n  info() {\n    return 'connect to a server';\n  }\n\n  _run(url, protocolString = '') {\n\n    const m = this._dwst.types.m;\n\n    if (this._dwst.model.connection !== null) {\n      throw new this._dwst.types.errors.AlreadyConnected();\n    }\n    const protoCandidates = (() => {\n      if (protocolString === '') {\n        return [];\n      }\n      return protocolString.split(',');\n    })();\n    const protocols = protoCandidates.filter(protocolName => {\n\n      // https://tools.ietf.org/html/rfc6455#page-17\n\n      const basicAlphabet = this._dwst.lib.utils.range(0x21, 0x7e).map(charCode => String.fromCharCode(charCode));\n      const httpSeparators = new Set([...'()<>@,;:\\\\\"/[]?={} \\t']);\n      const validProtocolChars = new Set(basicAlphabet.filter(character => !httpSeparators.has(character)));\n      const usedChars = [...protocolName];\n      const invalidCharsSet = new Set(usedChars.filter(character => !validProtocolChars.has(character)));\n      const invalidChars = [...invalidCharsSet];\n      if (invalidChars.length > 0) {\n        const invalidCharsString = invalidChars.map(character => `\"${character}\"`).join(', ');\n        this._dwst.ui.terminal.mlog([\n          `Skipped invalid protocol candidate \"${protocolName}\".`,\n          `The following characters are not allowed: ${invalidCharsString}`,\n        ], 'warning');\n        return false;\n      }\n      return true;\n    });\n    if (self.origin.startsWith('https://') && url.startsWith('ws://')) {\n      const secureUrl = `wss://${url.slice('ws://'.length)}`;\n      const secureConnect = `/connect ${secureUrl} ${protocolString}`;\n      this._dwst.ui.terminal.mlog([\n        m.line`Attempting unprotected connection from a secure origin. See ${m.help('#unprotected')} for details. Consider using ${m.command(secureConnect)}`,\n      ], 'warning');\n    }\n    this._dwst.model.connection = new Connection(url, protocols, this._dwst.controller.socket);\n    const protoFormatted = protocols.join(', ');\n    const negotiation = (() => {\n      if (protocols.length < 1) {\n        return ['No protocol negotiation.'];\n      }\n      return [`Accepted protocols: ${protoFormatted}`];\n    })();\n    this._dwst.ui.terminal.mlog([`Connecting to ${this._dwst.model.connection.url}`].concat(negotiation), 'system');\n  }\n\n  run(paramString) {\n    if (paramString.length < 1) {\n      this._run();\n      return;\n    }\n    const params = paramString.split(' ');\n    this._run(...params);\n  }\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nexport default class Disconnect {\n\n  constructor(dwst) {\n    this._dwst = dwst;\n  }\n\n  commands() {\n    return ['disconnect'];\n  }\n\n  usage() {\n    return [\n      '/disconnect',\n    ];\n  }\n\n  examples() {\n    return [\n      '/disconnect',\n    ];\n  }\n\n  info() {\n    return 'disconnect from a server';\n  }\n\n  run() {\n    if (this._dwst.model.connection === null) {\n      this._dwst.ui.terminal.log('No connection to disconnect', 'warning');\n      return;\n    }\n    const protocol = [];\n    this._dwst.ui.terminal.mlog([`Closing connection to ${this._dwst.model.connection.url}`].concat(protocol), 'system');\n    this._dwst.model.connection.close();\n  }\n}\n\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nexport default class Forget {\n\n  constructor(dwst) {\n    this._dwst = dwst;\n  }\n\n  commands() {\n    return ['forget'];\n  }\n\n  usage() {\n    return [\n      '/forget everything',\n    ];\n  }\n\n  examples() {\n    return [\n      '/forget everything',\n    ];\n  }\n\n  info() {\n    return 'empty history';\n  }\n\n  _removeHistory() {\n    this._dwst.model.history.forget();\n    const historyLine = this._dwst.model.history.getSummary().concat(['.']);\n    this._dwst.ui.terminal.mlog([\n      'Successfully forgot stored history!',\n      historyLine,\n    ], 'system');\n  }\n\n  _run(target) {\n    if (target === 'everything') {\n      this._removeHistory();\n      this._dwst.ui.terminal.log(\"You may wish to use your browser's cleaning features to remove tracking cookies and other remaining traces.\", 'warning');\n    } else {\n      const historyLine = this._dwst.model.history.getSummary().concat(['.']);\n      throw new this._dwst.types.errors.InvalidArgument(target, historyLine);\n    }\n  }\n\n  run(paramString) {\n    if (paramString.length < 1) {\n      this._run();\n      return;\n    }\n    const params = paramString.split(' ');\n    this._run(...params);\n  }\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nexport default class Help {\n\n  constructor(dwst) {\n    this._dwst = dwst;\n  }\n\n  commands() {\n    return ['help'];\n  }\n\n  usage() {\n    return [\n      '/help',\n      '/help <command>',\n    ];\n  }\n\n  examples() {\n    return [\n      '/help',\n      '/help send',\n      '/help binary',\n    ];\n  }\n\n  info() {\n    return 'get help';\n  }\n\n  _run(section = '#help') {\n    this._dwst.ui.terminal.clearLog();\n    const page = this._dwst.model.help.page(section);\n    this._dwst.ui.terminal.mlog(page, 'system');\n  }\n\n  run(paramString) {\n    if (paramString.length < 1) {\n      this._run();\n      return;\n    }\n    const params = paramString.split(' ');\n    this._run(...params);\n  }\n}\n\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nexport default class Interval {\n\n  constructor(dwst) {\n    this._dwst = dwst;\n  }\n\n  commands() {\n    return ['interval'];\n  }\n\n  usage() {\n    return [\n      '/interval <interval> [command line...]',\n      '/interval',\n    ];\n  }\n\n  examples() {\n    return [\n      '/interval 1000',\n      '/interval 1000 /binary ${randomBytes(10)}',\n      '/interval',\n    ];\n  }\n\n  info() {\n    return 'run an other command periodically';\n  }\n\n  _run(intervalStr = null, ...commandParts) {\n    if (intervalStr === null) {\n      if (this._dwst.model.intervalId === null) {\n        this._dwst.ui.terminal.log('No interval to clear', 'warning');\n        return;\n      }\n      clearInterval(this._dwst.model.intervalId);\n      this._dwst.model.intervalId = null;\n      this._dwst.ui.terminal.log('interval cleared', 'system');\n      return;\n    }\n    const [command, payload] = (() => {\n      if (commandParts.length < 1) {\n        return ['send', null];\n      }\n      const firstPart = commandParts[0];\n      const otherParts = commandParts.slice(1);\n      if (['/s', '/send', '/b', '/binary'].includes(firstPart) === false) {\n        throw new this._dwst.types.errors.InvalidCombination('interval', ['send', 'binary']);\n      }\n      return [firstPart.slice(1), otherParts.join(' ')];\n    })();\n    let count = 0;\n    const interval = this._dwst.lib.utils.parseNum(intervalStr);\n    const spammer = () => {\n      const message = (() => {\n        if (payload === null) {\n          return String(count);\n        }\n        return payload;\n      })();\n      if (this._dwst.model.connection === null || this._dwst.model.connection.isOpen() === false) {\n        if (this._dwst.model.intervalId !== null) {\n          clearInterval(this._dwst.model.intervalId);\n          this._dwst.model.intervalId = null;\n          throw new this._dwst.types.errors.NoConnection(message);\n        }\n        return;\n      }\n      this._dwst.controller.prompt.run([command, message].join(' '));\n      count += 1;\n    };\n    if (this._dwst.model.intervalId !== null) {\n      this._dwst.ui.terminal.log('clearing old interval', 'system');\n      clearInterval(this._dwst.model.intervalId);\n      this._dwst.model.intervalId = null;\n    }\n    this._dwst.model.intervalId = setInterval(spammer, interval);\n    this._dwst.ui.terminal.log('interval set', 'system');\n  }\n\n  run(paramString) {\n    if (paramString.length < 1) {\n      this._run();\n      return;\n    }\n    const params = paramString.split(' ');\n    this._run(...params);\n  }\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nexport default class Pwa {\n\n  constructor(dwst) {\n    this._dwst = dwst;\n  }\n\n  commands() {\n    return ['pwa'];\n  }\n\n  usage() {\n    return [\n      '/pwa <action>',\n    ];\n  }\n\n  examples() {\n    return [\n      '/pwa install',\n    ];\n  }\n\n  info() {\n    return 'control progressive web application features';\n  }\n\n  run(...args) {\n    if (args[0] === 'install') {\n      this._dwst.controller.pwa.onInstall();\n    }\n  }\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nexport default class Reset {\n\n  constructor(dwst) {\n    this._dwst = dwst;\n  }\n\n  commands() {\n    return ['reset'];\n  }\n\n  usage() {\n    return [\n      '/reset',\n    ];\n  }\n\n  examples() {\n    return [\n      '/reset',\n    ];\n  }\n\n  info() {\n    return 'reset the message buffer';\n  }\n\n  run() {\n    this._dwst.ui.terminal.reset();\n  }\n}\n\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nexport default class Send {\n\n  constructor(dwst) {\n    this._dwst = dwst;\n    this._encoder = new TextDecoder('utf-8', {fatal: true});\n  }\n\n  commands() {\n    return ['send', 's', ''];\n  }\n\n  usage() {\n    return [\n      '/send [template]',\n      '/s [template]',\n    ];\n  }\n\n  examples() {\n    return [\n      '/send Hello world!',\n      '/send [\"JSON\",\"is\",\"cool\"]',\n      '/send multiline\\\\r\\\\nmessage',\n      '/send null terminated string\\\\0one more\\\\0',\n      '/send tab\\\\x09separated\\\\x09strings',\n      '/send unicode snowman \\\\u2603',\n      '/send unicode tea cup \\\\u{1f375}',\n      '/s Available now with 60% less typing!',\n    ];\n  }\n\n  info() {\n    return 'send textual data';\n  }\n\n  _encode(buffer) {\n    try {\n      const text = new TextDecoder('utf-8', {fatal: true}).decode(buffer);\n      return text;\n    } catch (e) {\n      if (e instanceof TypeError) {\n        throw new this._dwst.types.errors.InvalidUtf8(buffer);\n      }\n      throw e;\n    }\n  }\n\n  async run(templateExpression) {\n    const buffer = await this._dwst.controller.template.eval(templateExpression);\n    const msg = this._encode(buffer);\n    const connection = this._dwst.model.connection;\n    if (connection === null || connection.isClosing() || connection.isClosed()) {\n      throw new this._dwst.types.errors.NoConnection(msg);\n    }\n    this._dwst.model.connection.send(msg);\n  }\n}\n\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nexport default class Set {\n\n  constructor(dwst) {\n    this._dwst = dwst;\n  }\n\n  commands() {\n    return ['set'];\n  }\n\n  usage() {\n    return [\n      '/set <variable> <value>',\n    ];\n  }\n\n  examples() {\n    return [\n      '/set foo 123',\n    ];\n  }\n\n  info() {\n    return 'set variable';\n  }\n\n  async run(paramString) {\n    const [variableName, ...templateExpressionParts] = paramString.split(' ');\n    if (variableName.length === 0) {\n      throw new this._dwst.types.errors.InvalidArgument(variableName, ['expected variable name']);\n    }\n    const templateExpression = templateExpressionParts.join(' ');\n    const buffer = await this._dwst.controller.template.eval(templateExpression);\n    this._dwst.model.variables.setVariable(variableName, buffer);\n    this._dwst.ui.terminal.mlog([\n      `${buffer.byteLength}B of data stored in variable ${variableName}`,\n    ], 'system');\n  }\n}\n\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nexport default class Spam {\n\n  constructor(dwst) {\n    this._dwst = dwst;\n  }\n\n  commands() {\n    return ['spam'];\n  }\n\n  usage() {\n    return [\n      '/spam <times> [command line...]',\n    ];\n  }\n\n  examples() {\n    return [\n      '/spam 10',\n      '/spam 6 /binary ${randomBytes(10)}',\n    ];\n  }\n\n  info() {\n    return 'run a command multiple times';\n  }\n\n  _run(timesStr, ...commandParts) {\n    const times = this._dwst.lib.utils.parseNum(timesStr);\n    const [command, payload] = (() => {\n      if (commandParts.length < 1) {\n        return ['send', null];\n      }\n      const firstPart = commandParts[0];\n      const otherParts = commandParts.slice(1);\n      if (['/s', '/send', '/b', '/binary'].includes(firstPart) === false) {\n        throw new this._dwst.types.errors.InvalidCombination('spam', ['send', 'binary']);\n      }\n      return [firstPart.slice(1), otherParts.join(' ')];\n    })();\n    const spam = (limit, i = 0) => {\n      if (i === limit) {\n        return;\n      }\n      const message = (() => {\n        if (payload === null) {\n          return String(i);\n        }\n        return payload;\n      })();\n      if (this._dwst.model.connection === null || this._dwst.model.connection.isOpen() === false) {\n        throw new this._dwst.types.errors.NoConnection(message);\n      }\n      this._dwst.controller.prompt.run([command, message].join(' '));\n      const nextspam = () => {\n        spam(limit, i + 1);\n      };\n      setTimeout(nextspam, 0);\n    };\n    spam(times);\n  }\n\n  run(paramString) {\n    if (paramString.length < 1) {\n      this._run();\n      return;\n    }\n    const params = paramString.split(' ');\n    this._run(...params);\n  }\n}\n\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nexport default class Splash {\n\n  constructor(dwst) {\n    this._dwst = dwst;\n  }\n\n  commands() {\n    return ['splash'];\n  }\n\n  usage() {\n    return [\n      '/splash',\n    ];\n  }\n\n  examples() {\n    return [\n      '/splash',\n    ];\n  }\n\n  info() {\n    return 'revisit welcome screen';\n  }\n\n  run() {\n\n    const m = this._dwst.types.m;\n\n    this._dwst.ui.terminal.clearLog();\n\n    /* eslint-disable quotes,object-property-newline */\n\n    /*\n    This template is left here as a comment in hopes it helps with creating new splash shapes.\n    The /idkfa command may also be of use when working with splash shapes.\n\n    const shape = [\n      \".       HH.      dd .        ..  TT    ..        ..        ..        ..    TT  ..        . dd      .HH       .\",\n      \".       HH.      dd .        ..  TT    ..        ..        ..        ..    TT  ..        . dd      .HH       .\",\n      \".       HH.      dd .        ..  TT    ..        ..        ..        ..    TT  ..        . dd      .HH       .\",\n      \".       HH.      dd .        ..  TT    ..        ..        ..        ..    TT  ..        . dd      .HH       .\",\n      \".       HH.      dd .        ..  TT    ..        ..        ..        ..    TT  ..        . dd      .HH       .\",\n      \".       HH.      dd .        ..  TT    ..        ..        ..        ..    TT  ..        . dd      .HH       .\",\n      \".       HH.      dd .        ..  TT    ..        ..        ..        ..    TT  ..        . dd      .HH       .\",\n      \".       HH.      dd .        ..  TT    ..        ..        ..        ..    TT  ..        . dd      .HH       .\",\n      \".       HH.      dd .        ..  TT    ..        ..        ..        ..    TT  ..        . dd      .HH       .\",\n      \".       HH.      dd .        ..  TT    ..        ..        ..        ..    TT  ..        . dd      .HH       .\",\n      \".       HH.      dd .        ..  TT    ..        ..        ..        ..    TT  ..        . dd      .HH       .\",\n      \".       HH.      dd .        ..  TT    ..        ..        ..        ..    TT  ..        . dd      .HH       .\",\n      \".       HH.      dd .        ..  TT    ..        ..        ..        ..    TT  ..        . dd      .HH       .\",\n      \".       HH.      dd .        ..  TT    ..        ..        ..        ..    TT  ..        . dd      .HH       .\",\n      \".       HH.      dd .        ..  TT    ..        ..        ..        ..    TT  ..        . dd      .HH       .\",\n      \".       HH.      dd .        ..  TT    ..        ..        ..        ..    TT  ..        . dd      .HH       .\",\n      \".       HH.      dd .        ..  TT    ..        ..        ..        ..    TT  ..        . dd      .HH       .\",\n      \".       HH.      dd .        ..  TT    ..        ..        ..        ..    TT  ..        . dd      .HH       .\",\n      \".       HH.      dd .        ..  TT    ..        ..        ..        ..    TT  ..        . dd      .HH       .\",\n    ];\n    */\n\n    const shape = [\n      \"                                                                                                              \",\n      \"                                                                                                              \",\n      \"                                                                                                              \",\n      \"                                                                                                              \",\n      \"                                   `ggg.                                                                      \",\n      \"                                     ggg                                                                      \",\n      \"                                      gg.                                                                     \",\n      \"                                       gg                                 ggg'                                \",\n      \"                                       gg                                 gg                                  \",\n      \"                                   ,ggg g.  ggg       ggg.   .gggggg.     g                                   \",\n      \"                                 ,gg  `ggg ggg         ggg. gg      `g.  gg                                   \",\n      \"                                 gg     gg.g'           `gg gg.       `gggggg'                                \",\n      \"                                 gg     ggg'             gg. 'gggggg.  ,g                                     \",\n      \"                                 ll.     ll.     ,l.      ll       `ll l.                                     \",\n      \"                                  ll.   llll.   ,lll.   ,ll l`     ,ll ll.                                    \",\n      \"                                   `lllll' `lllll' `lllll'  `lllllll'   lll.                                  \",\n      \"                                                                                                              \",\n      \"                                                                                                              \",\n      \"                                                                                                              \",\n    ];\n\n    const defaultColors = [\n      \"                                                                                                              \",\n      \"                                                                                                              \",\n      \"                                                                                                              \",\n      \"                                                                                                              \",\n      \"                                   fffff                                                                      \",\n      \"                                     fff                                                                      \",\n      \"                                      fff                                                                     \",\n      \"                                       ff                                 ffff                                \",\n      \"                                       ff                                 ff                                  \",\n      \"                                   ffff ff  fff       ffff   ffffffff     f                                   \",\n      \"                                 fff  ffff fff         ffff ff      fff  ff                                   \",\n      \"                                 ff     fffff           fff fff       ffffffff                                \",\n      \"                                 ff     ffff             fff ffffffff  ff                                     \",\n      \"                                 555     555     555      55       555 55                                     \",\n      \"                                  555   55555   55555   555 55     555 555                                    \",\n      \"                                   5555555 5555555 5555555  555555555   5555                                  \",\n      \"                                                                                                              \",\n      \"                                                                                                              \",\n      \"                                                                                                              \",\n    ];\n\n    const xmasColors = [\n      \"                                                                                                              \",\n      \"                                                                                                              \",\n      \"                                                                                                              \",\n      \"                                                                                                              \",\n      \"                                   77777                                                                      \",\n      \"                                     444                                                                      \",\n      \"                                      447                                                                     \",\n      \"                                       44                                 7777                                \",\n      \"                                       44                                 44                                  \",\n      \"                                   7774 44  777       7777   77777777     4                                   \",\n      \"                                 774  4444 444         4447 74      477  74                                   \",\n      \"                                 44     44444           444 444       47744444                                \",\n      \"                                 44     4444             447 44444444  44                                     \",\n      \"                                 222     222     222      22       222 22                                     \",\n      \"                                  222   22222   22222   222 22     222 222                                    \",\n      \"                                   2222222 2222222 2222222  222222222   2222                                  \",\n      \"                                                                                                              \",\n      \"                                                                                                              \",\n      \"                                                                                                              \",\n    ];\n\n    /* eslint-enable quotes,object-property-newline */\n\n    let colors = defaultColors;\n    const now = new Date();\n    const date = now.getDate();\n    const month = now.getMonth();\n    if (date === 24 && month === 11) {\n      colors = xmasColors;\n    }\n\n    const CONNECTION_LIST_CAP = 3;\n    const historySummary = this._dwst.model.history.getSummary();\n    const maybeTooManyConnectCommands =  this._dwst.model.history.getConnectCommands(CONNECTION_LIST_CAP + 1);\n    const connectCommands = maybeTooManyConnectCommands.slice(0, CONNECTION_LIST_CAP);\n    const connectionsLines = connectCommands.map(command => m.line`${m.command(command)}`);\n    const tooManyWarning = (() => {\n      if (maybeTooManyConnectCommands.length > CONNECTION_LIST_CAP) {\n        return [\n          `(more than ${CONNECTION_LIST_CAP} in total, hiding some)`,\n        ];\n      }\n      return [];\n    })();\n    const historySection = ([\n      historySummary.concat(m.line`, including ${m.help('connect')} commands`),\n    ]).concat(\n      connectionsLines,\n    ).concat(\n      tooManyWarning,\n    );\n    const statusSection = (() => {\n      if (this._dwst.model.connection === null) {\n        return [];\n      }\n      const connectionStatus = m.line`Currently ${this._dwst.model.connection.verb} to ${m.strong(this._dwst.model.connection.url)}`;\n      const maybeProtocolStatus = (() => {\n        const protocol = this._dwst.model.connection.protocol;\n        if (protocol.length < 1) {\n          return [];\n        }\n        return [\n          m.line`Selected protocol: ${m.strong(protocol)}`,\n        ];\n      })();\n      const disconnectInstructions = [\n        m.line`Type ${m.command('/disconnect')} to end the connection`,\n      ];\n      return ([\n        connectionStatus,\n      ]).concat(maybeProtocolStatus).concat([\n        '',\n        disconnectInstructions,\n      ]);\n    })();\n    const about = [\n      m.line`${m.h1(`Dark WebSocket Terminal ${this._dwst.model.config.appVersion}`)}`,\n    ];\n    const beginnerInfo = [\n      m.line`1. Create a test connection by typing ${m.command(`/connect ${this._dwst.model.config.echoServer}`)}`,\n      '2. Type messages into the text input',\n      '3. Click on DWST logo if you get lost',\n    ];\n    const helpReminder = [\n      m.line`Type ${m.command('/help')} to see the full range of available commands`,\n    ];\n    const privacyReminder = [\n      m.line`${m.help('Check', '#privacy', {warning: true})} privacy and tracking info`,\n    ];\n    const linkSection = [\n      m.line`${\n        m.link('https://github.com/dwst/dwst', 'GitHub')\n      }${m.unsafe(' &bull; ')}${\n        m.link('https://gitter.im/dwst/dwst', 'chat')\n      }${m.unsafe(' &bull; ')}${\n        m.link('https://tools.ietf.org/html/rfc6455', 'rfc6455')\n      }${m.unsafe(' &bull; ')}${\n        m.link('https://www.iana.org/assignments/websocket/websocket.xhtml', 'iana')\n      }`,\n    ];\n    const sections = (() => {\n      if (this._dwst.model.connection !== null) {\n        return [\n          about,\n          [''],\n          statusSection,\n          [''],\n          helpReminder,\n          [''],\n          linkSection,\n          [''],\n        ];\n      }\n      if (connectCommands.length > 0) {\n        return [\n          about,\n          [''],\n          historySection,\n          [''],\n          privacyReminder,\n          [''],\n          helpReminder,\n          [''],\n          linkSection,\n          [''],\n        ];\n      }\n      return [\n        about,\n        [''],\n        beginnerInfo,\n        [''],\n        privacyReminder,\n        [''],\n        helpReminder,\n        [''],\n        linkSection,\n        [''],\n      ];\n    })();\n    this._dwst.ui.terminal.gfx(shape, colors);\n    this._dwst.ui.terminal.mlog([].concat(...sections), 'system');\n  }\n\n}\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nexport default class Unset {\n\n  constructor(dwst) {\n    this._dwst = dwst;\n  }\n\n  commands() {\n    return ['unset'];\n  }\n\n  usage() {\n    return [\n      '/unset <variable>',\n    ];\n  }\n\n  examples() {\n    return [\n      '/unset foo',\n    ];\n  }\n\n  info() {\n    return 'delete variable';\n  }\n\n  run(variableName) {\n    if (variableName.length === 0) {\n      throw new this._dwst.types.errors.InvalidArgument(variableName, ['expected variable name']);\n    }\n    const buffer = this._dwst.model.variables.getVariable(variableName);\n    if (buffer === null) {\n      throw new this._dwst.types.errors.UnknownVariable(variableName);\n    }\n    this._dwst.model.variables.deleteVariable(variableName);\n    this._dwst.ui.terminal.mlog([\n      `Variable ${variableName} deleted`,\n    ], 'system');\n  }\n}\n\n","\n/**\n\n  Authors: Toni Ruottu, Finland 2010-2018\n\n  This file is part of Dark WebSocket Terminal.\n\n  CC0 1.0 Universal, http://creativecommons.org/publicdomain/zero/1.0/\n\n  To the extent possible under law, Dark WebSocket Terminal developers have waived all\n  copyright and related or neighboring rights to Dark WebSocket Terminal.\n\n*/\n\nexport default class Vars {\n\n  constructor(dwst) {\n    this._dwst = dwst;\n  }\n\n  commands() {\n    return ['vars'];\n  }\n\n  usage() {\n    return [\n      '/vars',\n      '/vars [name]',\n    ];\n  }\n\n  examples() {\n    return [\n      '/vars',\n      '/vars foo',\n    ];\n  }\n\n  info() {\n    return 'list variables';\n  }\n\n  _run(variable = null) {\n    if (variable !== null) {\n      const v = this._dwst.model.variables.getVariable(variable);\n      if (typeof v  === 'string') {\n        this._dwst.ui.terminal.tlog(v, 'system');\n        return;\n      }\n      if (v instanceof ArrayBuffer) {\n        this._dwst.ui.terminal.blog(v, 'system');\n        return;\n      }\n      if (v instanceof this._dwst.types.abstract.DwstFunction) {\n        this._dwst.ui.terminal.blog('<function>', 'system');\n        return;\n      }\n      throw new this._dwst.lib.errors.UnknownVariable(variable);\n    }\n    const vars = this._dwst.model.variables.getVariableNames();\n    if (vars.length === 0) {\n      this._dwst.ui.terminal.log('No variables in memory.', 'system');\n      return;\n    }\n    const listing = [...vars].map(name => {\n      const value = this._dwst.model.variables.getVariable(name);\n      if (typeof value  === 'string') {\n        const utf8 = new TextEncoder().encode(value);\n        return `${name} <${utf8.byteLength}B of utf-8 text>`;\n      }\n      if (value instanceof ArrayBuffer) {\n        return `${name} <${value.byteLength}B of binary data>`;\n      }\n      throw new Error('unexpected variable type');\n    });\n    const strs = ['Loaded vars:'].concat(listing);\n    this._dwst.ui.terminal.mlog(strs, 'system');\n  }\n\n  run(paramString) {\n    if (paramString.length < 1) {\n      this._run();\n      return;\n    }\n    const params = paramString.split(' ');\n    this._run(...params);\n  }\n}\n\n"],"sourceRoot":""}